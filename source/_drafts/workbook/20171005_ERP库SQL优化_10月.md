---
title: ERP库SQL优化_10月总计
date: 2017-10-05
categories:
- workbook
tags:
- sql优化
---

## 调优常用命令
``` perl
# 生成调优SQL PROFILE任务脚本
set serveroutput on
declare
l_tuning_task varchar2(30);
begin
 l_tuning_task := dbms_sqltune.create_tuning_task(sql_id => '&SQL_ID');
 dbms_sqltune.execute_tuning_task(l_tuning_task);
 dbms_output.put_line(l_tuning_task);
end;
/

# 禁用和启用SQL PROFILE
exec dbms_sqltune.alter_sql_profile(name => 'SYS_SQLPROF_015d0b25672e0005', attribute_name => 'status', value => 'disabled')
exec dbms_sqltune.alter_sql_profile(name => 'SYS_SQLPROF_015d0b25672e0005', attribute_name => 'status', value => 'enabled')

# 生成表统计信息
execute dbms_statS.gather_table_stats(ownname => 'BFCRM8', tabname =>'YDTEMP_SKU_TEMP', estimate_percent =>DBMS_STATS.AUTO_SAMPLE_SIZE, method_opt => 'FOR ALL COLUMNS SIZE AUTO', cascade => TRUE);
```

<!-- more -->

## ERP库
``` perl
1. 20171005
bj6cza77uygcq

select X.SPFL 商品分类代码 , F.NAME 商品分类名称 , X.SPCODE 商品代码 , M.OLD_SPCODE 商品旧码 , X.SP_ID 商品ID , X.BARCODE 条码 , X.PYM 拼音码 , X.NAME 商品名称 , M.ZHJJ 原进价 , M.LSDJ 原售价 ,
(SELECT A.JHDJ_HS
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 and C.FDBH=M.MCID ) AS 促销进价 ,
(SELECT A.LSDJ
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 AND C.FDBH=M.MCID ) AS 促销售价 , (case X.SPTYPE when 0 then '自动单价' when 1 then '手工单价' end) AS 价格类型 , M.SPTX 商品特性ID , '' 商品特性 , B.BMDM 商品销售部门代码 , B.DEPT_NAME 商品销售部门 , DECODE(M.BJ_SPBZ,0,'普通商品',1,'永续商品') 商品标识 , DECODE(M.LSDJ,0,0,ROUND((M.LSDJ-M.CGJ_HS)/M.LSDJ,4)) 加价率 , M.KSRQ 开始时间 , M.JSRQ 结束时间 , DECODE(M.BJ_BCJBD,0,'不参加保底',1,'参加保底') 是否参加保底 , R.NAME 产地名称 , S.NAME 商标 , X.HH 商品货号 , X.SPGG 商品规格 ,
(SELECT L.JSKL
FROM HT_LY_JSKL L
WHERE L.HTH=M.HTH AND L.CODE=M.JSKL_CODE) 结算扣率 , M.JHRQ_SC 首次进货日期 , M.JHRQ_ZH 最后进货日期 , X.SPYT 使用对象 , X.UNIT 计量单位 , M.PFDJ 批发单价 , M.CGJ_HS 含税进货单价 , M.LSDJ 零售单价 , M.HYLSDJ 会员零售价 , X.XXSL*100 "销项税率(%)" , X.JXSL*100 "进项税率(%)" , X.MBHL 统计比例 , M.HTH 合同号 , H.YDHTH 原远大合同号 , decode(X.SPTYPE,'0','品种','1','大类','2','细类','3','出租柜组','4','黄金饰品') 类别 , W.NAME 供货单位 , X.ZLDJ 质量等级 , X.ZDHL 质地含量 , decode(H.HSFS,'0','经销','1','代销','2','出租柜组','3','联营','4','物口','5','租赁') 核算方式 , X.DJRMC 登记人名称 , X.DJRQ 登记日期 , X.ZXRMC 审核人名称 , trunc(X.ZXRQ) 审核日期 , X.GXRMC 最后修改人 , X.GXSJ 最后修改时间 , decode(M.STATUS,'-1','特殊商品','0','正常','1','未审核','2','淘汰','3','新品','4','暂停','5','终止') as 商品状态 , X.TTSJ 淘汰时间 , decode(M.CJSX,0,'进口',1,'国产',2,'合资') 性质 , M.MCID 分店编号 , F.FDMC 门店名称 ,
(select BZHL
from SPBZ B1
where B1.SP_ID=X.SP_ID and ROWNUM=1) 包装含量 , decode(X.SZSPBJ,0,'非散装',1,'称重散装',2,'独立散装','') 散装商品标记 , M.QPZ "去皮重(g)" , X.BZQTS 保质期天数 ,
(SELECT BARCODE
FROM SPBARCODE A
WHERE A.SP_ID=X.SP_ID AND A.LX=4) PLU码 , M.DJSJ_MC 卖场登记时间 , DECODE(X.BJ_MIANCODE,1,'主编码','非主编码') 主编码标记 , DECODE(H.STATUS,'0','未审核','1','转审批','2','审批通过','3','待启动','4','试销','5','正常','6','到期','7','终止','8','清退') As 合同状态 ,
nvl((SELECT NVL(K.KCSL,0) KCSL
FROM SPKC K
WHERE K.SP_ID=X.SP_ID AND K.DEPTID=B.DEPTID),0) AS 库存数量
from SPXX X , SPFL F , SPSB S , WLDW W , REGION R , SPXX_MC M , HT H , FDDEF F , BM B
where X.SPFL=F.SPFL(+) AND M.GHDW=W.CODE(+) AND M.DEPTID_XS=B.DEPTID and M.CDDM=R.CODE(+) and X.SB=S.SBID and X.SP_ID=M.SP_ID(+) AND M.HTH=H.HTH AND M.MCID=F.FDBH AND B.BMDM LIKE '010102010104%' and ((B.BMDM like '0101020101%') or (B.BMDM like '010102010408%') or (B.BMDM like '010202%')) and M.MCID in (1) and M.MCID in (1) order by X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32687', task_owner => 'SYS', replace => TRUE, force_match => true);

SYS_SQLPROF_015eebb5e0d7009b
#======================================================================================================================================

2. 20171009
7ac8th69pvxsy

SELECT X.SP_ID,X.SPCODE 商品代码,X.NAME 商品名称, SUM(((1-ABS(SIGN(I.YWLX-10)))+(1-ABS(SIGN(I.YWLX-13)))+(1-ABS(SIGN(I.YWLX-14)))+(1-ABS(SIGN(I.YWLX-15))))*(I.JE+I.SJ)) XSCB, 0 含券毛利,0 去券毛利 FROM SPJXCR R,SPJXCR_XM I,BM B,SPXX X,SPXX_MC M WHERE R.ID=I.ID AND R.DEPTID=B.DEPTID AND X.SP_ID=R.SP_ID AND X.SP_ID=M.SP_ID AND B.FDBH=M.MCID AND R.RQ>=TO_DATE('2017/9/1','yyyy-mm-dd') AND R.RQ <TO_DATE('2017-10-1','yyyy-mm-dd') AND B.BMDM LIKE '010101%' AND B.FDBH IN (1) AND (B.FDBH IN (1,2)) AND ((B.BMDM LIKE '01%')) GROUP BY X.SP_ID,X.NAME,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32796', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================


3. 20171009
2d2kgq73vpdax

select X.SPFL 商品分类代码 , F.NAME 商品分类名称 , X.SPCODE 商品代码 , M.OLD_SPCODE 商品旧码 , X.SP_ID 商品ID , X.BARCODE 条码 , X.PYM 拼音码 , X.NAME 商品名称 , M.ZHJJ 原进价 , M.LSDJ 原售价 ,
(SELECT A.JHDJ_HS
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 and C.FDBH=M.MCID ) AS 促销进价 ,
(SELECT A.LSDJ
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 AND C.FDBH=M.MCID ) AS 促销售价 , (case X.SPTYPE when 0 then '自动单价' when 1 then '手工单价' end) AS 价格类型 , M.SPTX 商品特性ID , '' 商品特性 , B.BMDM 商品销售部门代码 , B.DEPT_NAME 商品销售部门 , DECODE(M.BJ_SPBZ,0,'普通商品',1,'永续商品') 商品标识 , DECODE(M.LSDJ,0,0,ROUND((M.LSDJ-M.CGJ_HS)/M.LSDJ,4)) 加价率 , M.KSRQ 开始时间 , M.JSRQ 结束时间 , DECODE(M.BJ_BCJBD,0,'不参加保底',1,'参加保底') 是否参加保底 , R.NAME 产地名称 , S.NAME 商标 , X.HH 商品货号 , X.SPGG 商品规格 ,
(SELECT L.JSKL
FROM HT_LY_JSKL L
WHERE L.HTH=M.HTH AND L.CODE=M.JSKL_CODE) 结算扣率 , M.JHRQ_SC 首次进货日期 , M.JHRQ_ZH 最后进货日期 , X.SPYT 使用对象 , X.UNIT 计量单位 , M.PFDJ 批发单价 , M.CGJ_HS 含税进货单价 , M.LSDJ 零售单价 , M.HYLSDJ 会员零售价 , X.XXSL*100 "销项税率(%)" , X.JXSL*100 "进项税率(%)" , X.MBHL 统计比例 , M.HTH 合同号 , H.YDHTH 原远大合同号 , decode(X.SPTYPE,'0','品种','1','大类','2','细类','3','出租柜组','4','黄金饰品') 类别 , W.NAME 供货单位 , X.ZLDJ 质量等级 , X.ZDHL 质地含量 , decode(H.HSFS,'0','经销','1','代销','2','出租柜组','3','联营','4','物口','5','租赁') 核算方式 , X.DJRMC 登记人名称 , X.DJRQ 登记日期 , X.ZXRMC 审核人名称 , trunc(X.ZXRQ) 审核日期 , X.GXRMC 最后修改人 , X.GXSJ 最后修改时间 , decode(M.STATUS,'-1','特殊商品','0','正常','1','未审核','2','淘汰','3','新品','4','暂停','5','终止') as 商品状态 , X.TTSJ 淘汰时间 , decode(M.CJSX,0,'进口',1,'国产',2,'合资') 性质 , M.MCID 分店编号 , F.FDMC 门店名称 ,
(select BZHL
from SPBZ B1
where B1.SP_ID=X.SP_ID and ROWNUM=1) 包装含量 , decode(X.SZSPBJ,0,'非散装',1,'称重散装',2,'独立散装','') 散装商品标记 , M.QPZ "去皮重(g)" , X.BZQTS 保质期天数 ,
(SELECT BARCODE
FROM SPBARCODE A
WHERE A.SP_ID=X.SP_ID AND A.LX=4) PLU码 , M.DJSJ_MC 卖场登记时间 , DECODE(X.BJ_MIANCODE,1,'主编码','非主编码') 主编码标记 , DECODE(H.STATUS,'0','未审核','1','转审批','2','审批通过','3','待启动','4','试销','5','正常','6','到期','7','终止','8','清退') As 合同状态 ,
nvl((SELECT NVL(K.KCSL,0) KCSL
FROM SPKC K
WHERE K.SP_ID=X.SP_ID AND K.DEPTID=B.DEPTID),0) AS 库存数量
from SPXX X , SPFL F , SPSB S , WLDW W , REGION R , SPXX_MC M , HT H , FDDEF F , BM B
where X.SPFL=F.SPFL(+) AND M.GHDW=W.CODE(+) AND M.DEPTID_XS=B.DEPTID and M.CDDM=R.CODE(+) and X.SB=S.SBID and X.SP_ID=M.SP_ID(+) AND M.HTH=H.HTH AND M.MCID=F.FDBH and (H.HSFS in (0,1)) AND B.BMDM LIKE '010102010104%' and ((B.BMDM like '0101020101%') or (B.BMDM like '010102010408%') or (B.BMDM like '010202%')) and M.MCID in (1) and M.MCID in (1) order by X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32798', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

4. 20171009
72fb3s0txzp8f

SELECT L.RQ , B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017/9/1','yyyy-mm-dd') and L.RQ<to_date('2017/10/1','yyyy-mm-dd') and B.BMDM LIKE '0101%' and M.MCID in (1) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010103010204%') or (B.BMDM like '010202%')) and M.HTH =12382500 and L.RQ >=to_date('2017/9/1','yyyy-mm-dd') and L.RQ <=to_date('2017/9/30','yyyy-mm-dd') GROUP BY L.RQ,B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32799', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

5. 20171009
8953qzqk1w92y

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017-7-9','yyyy-mm-dd') and G.RQ<to_date('2017-10-9','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32800', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

6. 20171009
9g6umr5u4jycm

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE)) 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/count(distinct C.SKTNO||to_char(C.JLBH))),2) 票单价 , SUM(C.XSSL) 销售数量 , round(DECODE(SUM(C.XSSL),0,0,SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/SUM(C.XSSL)),2) 件单价 , round(DECODE(SUM(C.XSSL),0,0,sum(S.SKJE)/SUM(C.XSSL)),2) 含券件单价 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, sum(S.SKJE)/count(distinct C.SKTNO||to_char(C.JLBH))),2) 含券票单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2017/1/1','yyyy-mm-dd') and R.RQ<=to_date('2017/9/30','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X , SKFS F
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and S.SKFS=F.CODE and L.JZRQ >=to_date('2017/1/1','yyyy-mm-dd') and L.JZRQ <=to_date('2017/9/30','yyyy-mm-dd') and B.BMDM like '01020102%' and B.FDBH in (2) and (B.FDBH in (2)) and ((B.BMDM like '01020102%') or (B.BMDM like '01020103%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32802', task_owner => 'SYS', replace => TRUE, force_match => true);

#======================================================================================================================================

7. 20171010
9w1gqbuaa9cz6

SELECT decode(A.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') as 属性 , A.HTH 合同号 ,
(SELECT NAME
FROM HT_SPSB HP,SPSB
WHERE HP.SPSB=SPSB.SBID and HP.HTH=A.HTH AND HP.ZYBJ=1) AS 主营商标 , M.BMDM||M.DEPT_NAME as 部门名称 , C.CODE 供货单位代码 , C.NAME as 供货单位名称 , SUM(A.JCJE_HS) AS 库存金额 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE) AS 销售额 , SUM(A.XSSL+A.WRZXSSL) 销售数量 , SUM(A.XSCB+nvl(A.XSCB_YG,0)+nvl(A.WRZXSCB_CL,0)+nvl(A.WRZXSCB_YG,0)) AS 不含税销售成本 , SUM(A.XSCB_HS+nvl(A.XSCB_YG_HS,0)+nvl(A.WRZXSCB_CL_HS,0)+nvl(A.WRZXSCB_YG_HS,0)) AS 含税销售成本 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) AS 毛利 , ROUND(TO_NUMBER(decode(SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE),0,0, SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) /SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE)))*100,2) AS "毛利率%"
FROM GHDWJXCR A , BM B , WLDW C , BM M , HT H
WHERE B.DEPTID = A.DEPTID AND A.CODE = C.CODE AND A.HTH=H.HTH and A.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and B.BMDM like '01010103%' and A.RQ >=to_date('2017/9/1','yyyy-mm-dd') and A.RQ <=to_date('2017/10/9','yyyy-mm-dd') and B.FDBH in (1) and (B.FDBH in (1,2)) and ((B.BMDM like '010101%') or (B.BMDM like '010102%') or (B.BMDM like '010104%') or (B.BMDM like '010201%') or (B.BMDM like '010202%') or (B.BMDM like '010204%')) GROUP BY M.BMDM,M.DEPT_NAME,C.CODE,C.NAME,A.HSFS,A.HTH

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32824', task_owner => 'SYS', replace => TRUE, force_match => true);

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32826', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

8. 20171011
4ur591x27b23v

SELECT decode(A.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') as 属性 , A.HTH 合同号 ,
(SELECT NAME
FROM HT_SPSB HP,SPSB
WHERE HP.SPSB=SPSB.SBID and HP.HTH=A.HTH AND HP.ZYBJ=1) AS 主营商标 , M.BMDM||M.DEPT_NAME as 部门名称 , C.CODE 供货单位代码 , C.NAME as 供货单位名称 , SUM(A.JCJE_HS) AS 库存金额 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE) AS 销售额 , SUM(A.XSSL+A.WRZXSSL) 销售数量 , SUM(A.XSCB+nvl(A.XSCB_YG,0)+nvl(A.WRZXSCB_CL,0)+nvl(A.WRZXSCB_YG,0)) AS 不含税销售成本 , SUM(A.XSCB_HS+nvl(A.XSCB_YG_HS,0)+nvl(A.WRZXSCB_CL_HS,0)+nvl(A.WRZXSCB_YG_HS,0)) AS 含税销售成本 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) AS 毛利 , ROUND(TO_NUMBER(decode(SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE),0,0, SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) /SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE)))*100,2) AS "毛利率%"
FROM GHDWJXCR A , BM B , WLDW C , BM M , HT H
WHERE B.DEPTID = A.DEPTID AND A.CODE = C.CODE AND A.HTH=H.HTH and A.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and B.BMDM like '0101020101%' and A.RQ >=to_date('2017/6/29','yyyy-mm-dd') and A.RQ <=to_date('2017/10/10','yyyy-mm-dd') and B.FDBH in (1) and (B.FDBH in (1,2)) and ((B.BMDM like '010102%') or (B.BMDM like '010202%')) GROUP BY M.BMDM,M.DEPT_NAME,C.CODE,C.NAME,A.HSFS,A.HTH

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32853', task_owner => 'SYS', replace => TRUE, force_match => true);
SYS_SQLPROF_015f09403b3b00a3
#======================================================================================================================================

9. 20171011
fyz4nuzayttxb

SELECT B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017-1-1','yyyy-mm-dd') and L.RQ<to_date('2017-10-1','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and L.RQ >=to_date('2017/1/1','yyyy-mm-dd') and L.RQ <=to_date('2017/9/30','yyyy-mm-dd') GROUP BY B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

create index BFBHDD9.IDX_HT_LY_JSKL_LYJ on BFBHDD9.HT_LY_JSKL("CODE", "HTH", "JSKL"*100) tablespace jxc_index;
create index BFBHDD9.IDX_SPJXCR_XM_LYJ on BFBHDD9.SPJXCR_XM("ID") tablespace jxc_index;

drop index IDX_HT_LY_JSKL_LYJ;
drop index IDX_SPJXCR_XM_LYJ;

exec dbms_statS.gather_table_stats(ownname=>'BFBHDD9',tabname=>'SPJXCR_XM',estimate_percent=>10,method_opt=>'for all indexed columns',cascade=>TRUE);

exec dbms_statS.gather_table_stats(ownname=>'BFBHDD9',tabname=>'HT_LY_JSKL',estimate_percent=>10,method_opt=>'for all indexed columns',cascade=>TRUE);

#======================================================================================================================================

10. 20171011
24095ckj7c49k

SELECT decode(A.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') as 属性 , A.HTH 合同号 ,
(SELECT NAME
FROM HT_SPSB HP,SPSB
WHERE HP.SPSB=SPSB.SBID and HP.HTH=A.HTH AND HP.ZYBJ=1) AS 主营商标 , M.BMDM||M.DEPT_NAME as 部门名称 , C.CODE 供货单位代码 , C.NAME as 供货单位名称 , SUM(A.JCJE_HS) AS 库存金额 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE) AS 销售额 , SUM(A.XSSL+A.WRZXSSL) 销售数量 , SUM(A.XSCB+nvl(A.XSCB_YG,0)+nvl(A.WRZXSCB_CL,0)+nvl(A.WRZXSCB_YG,0)) AS 不含税销售成本 , SUM(A.XSCB_HS+nvl(A.XSCB_YG_HS,0)+nvl(A.WRZXSCB_CL_HS,0)+nvl(A.WRZXSCB_YG_HS,0)) AS 含税销售成本 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) AS 毛利 , ROUND(TO_NUMBER(decode(SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE),0,0, SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) /SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE)))*100,2) AS "毛利率%"
FROM GHDWJXCR A , BM B , WLDW C , BM M , HT H
WHERE B.DEPTID = A.DEPTID AND A.CODE = C.CODE AND A.HTH=H.HTH and A.DEPTID=B.DEPTID and substr(B.BMDM,1,12)=M.BMDM and length(M.BMDM)=12 and B.BMDM like '01010201%' and A.RQ >=to_date('2017-1-1','yyyy-mm-dd') and A.RQ <=to_date('2017-9-30','yyyy-mm-dd') and B.FDBH in (1) and (B.FDBH in (1)) and ((B.BMDM like '0101%') or (B.BMDM like '010202%') or (B.BMDM like '010205%') or (B.BMDM like '010299%')) GROUP BY M.BMDM,M.DEPT_NAME,C.CODE,C.NAME,A.HSFS,A.HTH

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32858', task_owner => 'SYS', replace => TRUE, force_match => true);

#======================================================================================================================================
11. 20171011
83yywrk7w6g9w

SELECT G.RQ , B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017-9-25','yyyy-mm-dd') and G.RQ<to_date('2017-10-11','yyyy-mm-dd') and X.NAME LIKE '%坦恩%' and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1) AND B.FDBH=M.MCID and ((B.BMDM like '0101020101%') or (B.BMDM like '010102010408%') or (B.BMDM like '010202%')) GROUP BY G.RQ,B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32861', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

12. 20171011
avc01zxgj7x73

SELECT decode(A.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') as 属性 , A.HTH 合同号 ,
(SELECT NAME
FROM HT_SPSB HP,SPSB
WHERE HP.SPSB=SPSB.SBID and HP.HTH=A.HTH AND HP.ZYBJ=1) AS 主营商标 , M.BMDM||M.DEPT_NAME as 部门名称 , C.CODE 供货单位代码 , C.NAME as 供货单位名称 , SUM(A.JCJE_HS) AS 库存金

额 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE) AS 销售额 , SUM(A.XSSL+A.WRZXSSL) 销售数量 , SUM(A.XSCB+nvl(A.XSCB_YG,0)+nvl(A.WRZXSCB_CL,0)+nvl(A.WRZXSCB_YG,0)) AS 不含税销售成本 , SUM(A.XSCB_HS+nvl(A.XSCB_YG_HS,0)+nvl(A.WRZXSCB_CL_HS,0)+nvl(A.WRZXSCB_YG_HS,0)) AS 含税销售成本 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) AS 毛利 , ROUND(TO_NUMBER(decode(SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE),0,0, SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) /SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE)))*100,2) AS "毛利率%"
FROM GHDWJXCR A , BM B , WLDW C , BM M , HT H
WHERE B.DEPTID = A.DEPTID AND A.CODE = C.CODE AND A.HTH=H.HTH and A.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and B.BMDM like '010102010104%' and A.RQ >=to_date('2017/6/30','yyyy-mm-dd') and A.RQ <=to_date('2017/10/10','yyyy-mm-dd') and (A.HSFS in (0,1)) and B.FDBH in (1) and (B.FDBH in (1)) and ((B.BMDM like '0101020101%') or (B.BMDM like '010102010408%') or (B.BMDM like '010202%')) GROUP BY M.BMDM,M.DEPT_NAME,C.CODE,C.NAME,A.HSFS,A.HTH

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32864', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

13. 20171011
1jw76nhaya1p9

SELECT decode(A.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') as 属性 , A.HTH 合同号 ,
(SELECT NAME
FROM HT_SPSB HP,SPSB
WHERE HP.SPSB=SPSB.SBID and HP.HTH=A.HTH AND HP.ZYBJ=1) AS 主营商标 , M.BMDM||M.DEPT_NAME as 部门名称 , C.CODE 供货单位代码 , C.NAME as 供货单位名称 , SUM(A.JCJE_HS) AS 库存金额 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE) AS 销售额 , SUM(A.XSSL+A.WRZXSSL) 销售数量 , SUM(A.XSCB+nvl(A.XSCB_YG,0)+nvl(A.WRZXSCB_CL,0)+nvl(A.WRZXSCB_YG,0)) AS 不含税销售成本 , SUM(A.XSCB_HS+nvl(A.XSCB_YG_HS,0)+nvl(A.WRZXSCB_CL_HS,0)+nvl(A.WRZXSCB_YG_HS,0)) AS 含税销售成本 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) AS 毛利 , ROUND(TO_NUMBER(decode(SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE),0,0, SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) /SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE)))*100,2) AS "毛利率%"
FROM GHDWJXCR A , BM B , WLDW C , BM M , HT H
WHERE B.DEPTID = A.DEPTID AND A.CODE = C.CODE AND A.HTH=H.HTH and A.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and B.BMDM like '010102010104%' and H.JSFS in (4 ) and A.RQ >=to_date('2017-6-30','yyyy-mm-dd') and A.RQ <=to_date('2017-10-10','yyyy-mm-dd') and (A.HSFS in (0,1)) and B.FDBH in (1) and (B.FDBH in (1)) and ((B.BMDM like '0101020101%') or (B.BMDM like '010102010408%') or (B.BMDM like '010202%')) GROUP BY M.BMDM,M.DEPT_NAME,C.CODE,C.NAME,A.HSFS,A.HTH

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32865', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================


14. 20171012
50q5983jc4mv3

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , 0 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , 0 票单价 , 0 销售数量 , 0 件单价 , 0 含券票单价 , 0 含券件单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2017/9/1','yyyy-mm-dd') and R.RQ<=to_date('2017/9/30','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and L.JZRQ >=to_date('2017/9/1','yyyy-mm-dd') and L.JZRQ <=to_date('2017/9/30','yyyy-mm-dd') and B.BMDM like '0102%' and B.FDBH in (2) and (B.FDBH in (1,2)) and ((B.BMDM like '01%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32892', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

15. 20171013
3zcx3ms7bmar7

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_促销卡" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '010101%' and ((B.BMDM like '0101%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (3)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32912', task_owner => 'SYS', replace => TRUE, force_match => true);
SYS_SQLPROF_015f13a1d6b300aa  2017-10-13 10:48:14
#======================================================================================================================================

16. 20171013
f6ca6a854901g

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_促销卡" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,6)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '010101%' and ((B.BMDM like '0101%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (3)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32913', task_owner => 'SYS', replace => TRUE, force_match => true);
SYS_SQLPROF_015f13a835dd00ab  2017-10-13 10:55:11
#======================================================================================================================================

17. 20171013
550d4f75zz649 (优化后性能不及优化前，取消优化)

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , 0 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , 0 票单价 ,
(select sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13))) )*I.SL)
from SPJXCR_XM I,SPJXCR R
WHERE I.ID=R.ID AND R.SP_ID=C.SP_ID AND R.DEPTID=B.DEPTID and RQ>='2017/9/15' and RQ<='2017/9/30') 销售数量 , 0 件单价 , 0 含券票单价 , 0 含券件单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2017/9/15','yyyy-mm-dd') and R.RQ<=to_date('2017/9/30','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and L.JZRQ >=to_date('2017/9/15','yyyy-mm-dd') and L.JZRQ <=to_date('2017/9/30','yyyy-mm-dd') and B.BMDM like '0102%' and B.FDBH in (2) and (B.FDBH in (1,2)) and ((B.BMDM like '01%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID,C.SP_ID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32915', task_owner => 'SYS', replace => TRUE, force_match => true);
(优化后性能不及优化前，取消优化)
#======================================================================================================================================

18. 20171013
99hs1bmbj7ug7

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_促销卡" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-10-12' and S.RQ <= '2017-10-12' and B.BMDM LIKE '010101%' and ((B.BMDM like '0101%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_32919', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

19. 20171013
401jhg1qt7d1f

SELECT G.SB 品牌ID , S.NAME 品牌名称 , M.BMDM 部门ID , M.DEPT_NAME 部门名称 , NVL(SUM(NVL(G.XSJE,0)),0) 全部满储券满减券流水
FROM SPSKFSXS G , SPSB S , BM B , BM M , SKFS F
WHERE G.SB=S.SBID AND G.DEPTID=B.DEPTID AND G.SKFS=F.CODE AND F.BJ_QYHQ=1 and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and G.FDBH in (1) and (G.FDBH in (1)) and G.FDBH=1 and B.BMDM like '010101%' and G.RQ >=to_date('2017/7/1','yyyy-mm-dd') and G.RQ <= to_date('2017/9/30','yyyy-mm-dd') and ((B.BMDM like '010101%')) group by G.SB,S.NAME,M.BMDM,M.DEPT_NAME having SUM(G.XSJE)<>0 ORDER BY G.SB,S.NAME,M.BMDM,M.DEPT_NAME

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32920',task_owner=>'SYS',replace=>true,force_match=>true);
SYS_SQLPROF_015f147700b500ae    2017-10-13 14:41:04
#======================================================================================================================================

20. 20171013
d12szynkjkdbc

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017/9/1','yyyy-mm-dd') and G.RQ<to_date('2017/10/13','yyyy-mm-dd') and X.NAME LIKE '%%美珍轩%%' and B.BMDM LIKE '010202%' and M.MCID in (2) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '0101020102%') or (B.BMDM like '0102020102%') or (B.BMDM like '01020202%') or (B.BMDM like '010302%')) GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32921',task_owner=>'SYS',replace=>true,force_match=>true);
SYS_SQLPROF_015f147bb56f00af   2017-10-13 14:46:12
#======================================================================================================================================

21. 20171013
an8z9twjcusty

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '010101010303%' and ((B.BMDM like '0101%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0,1,3,5)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32924',task_owner=>'SYS',replace=>true,force_match=>true);
SYS_SQLPROF_015f14dd9c2800b0  2017-10-13 16:33:08
#======================================================================================================================================

22. 20171013
apj998fh77ckb

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '010101010303%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0,1,3,5)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32925',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

23. 20171013
454azn8mphf5r

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,6)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '010101010303%' and ((B.BMDM like '0101%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0,1,3,5)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32926',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

24. 20171013
c6ttm2c8sfufc

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,6)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '010101010303%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0,1,3,5)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32927',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

25. 20171013
5mdtd59wm9mr0

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群30倍积分返点" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '010101010303%' and ((B.BMDM like '0101%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (3)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32928',task_owner=>'SYS',replace=>true,force_match=>true);
SYS_SQLPROF_015f14f032f300b4  2017-10-13 16:53:26
#======================================================================================================================================

26. 20171013
2sjbb6sst3yan

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2016-1-1','yyyy-mm-dd') and G.RQ<to_date('2017-1-1','yyyy-mm-dd') and B.BMDM LIKE '0102020102%' and M.MCID in (2) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and (M.HSFS in (0,1,3)) GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32934',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

27. 20171015
96h1kxa758x6b

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2016-1-1','yyyy-mm-dd') and G.RQ<to_date('2017-1-1','yyyy-mm-dd') and B.BMDM LIKE '0101020102%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and (M.HSFS in (5)) GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_32980',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

28. 20171019
0rd5fkxr5vw3v

SELECT G.SB 品牌ID , S.NAME 品牌名称 , M.BMDM 部门ID , M.DEPT_NAME 部门名称 , SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE) 销售金额含券原值 , SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE-G.XSCB_HS-nvl(G.XSCB_YG_HS,0)-nvl(G.WRZXSCB_CL_HS,0)-nvl(G.WRZXSCB_YG_HS,0)) 销售毛利含券原值 , SUM(G.XSSL) 销售数量 , SUM(G.WRZXSSL) 未入账销售数量 , 0 件单价 , 0 全部满储券满减券流水 , 0 正柜满储券满减券流水
FROM SPZHSJR G , SPSB S , BM B , BM M
WHERE G.SB=S.SBID AND G.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and G.FDBH in (2) and (G.FDBH in (1,2)) and G.FDBH=2 and B.BMDM like '010201010301%' and G.RQ >=to_date('2017/1/1','yyyy-mm-dd') and G.RQ <= to_date('2017/9/30','yyyy-mm-dd') and ((B.BMDM like '01020101%') or (B.BMDM like '01020106%')) group by G.SB,S.NAME,M.BMDM,M.DEPT_NAME having (SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE)<>0 OR SUM(nvl(G.XSCB_HS,0)+nvl(G.XSCB_YG_HS,0)+nvl(G.WRZXSCB_CL_HS,0)+nvl(G.WRZXSCB_YG_HS,0))<>0) ORDER BY G.SB,S.NAME,M.BMDM,M.DEPT_NAME

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33089',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

29. 20171019
9nbknrvt3qwt4

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,6)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '0101%' and ((B.BMDM like '01%')) and B.FDBH in (1) and (S.FDBH in (1,2)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33092',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

30. 20171019
2n60tzhaykupr

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆币B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群28倍积分返点" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群店庆百货币" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群好百客积分券" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '0101%' and ((B.BMDM like '01%')) and B.FDBH in (1) and (S.FDBH in (1,2)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33093',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

31. 20171024
0984p0dq82tqg

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017-6-29','yyyy-mm-dd') and G.RQ<to_date('2017-10-11','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1) AND B.FDBH=M.MCID and ((B.BMDM like '0101%') or (B.BMDM like '010202%') or (B.BMDM like '010205%') or (B.BMDM like '010299%')) and (M.HSFS in (0,1)) GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33226',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

32. 20171025
fuc1rbbjt994j

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/8/24','yyyy-mm-dd') and G.RQ<to_date('2017/10/25','yyyy-mm-dd') and B.BMDM LIKE '010202%' and M.MCID in (2) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '0101020102%') or (B.BMDM like '0102020102%') or (B.BMDM like '01020202%') or (B.BMDM like '010302%')) GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33262',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================


33. 20171026
8xxgwrjhmsvnu

SELECT G.SB 品牌ID , S.NAME 品牌名称 , M.BMDM 部门ID , M.DEPT_NAME 部门名称 , SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE) 销售金额含券原值 , SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE-G.XSCB_HS-nvl(G.XSCB_YG_HS,0)-nvl(G.WRZXSCB_CL_HS,0)-nvl(G.WRZXSCB_YG_HS,0)) 销售毛利含券原值 , SUM(G.XSSL) 销售数量 , SUM(G.WRZXSSL) 未入账销售数量 , 0 件单价 , 0 全部满储券满减券流水 , 0 正柜满储券满减券流水
FROM SPZHSJR G , SPSB S , BM B , BM M
WHERE G.SB=S.SBID AND G.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and G.FDBH in (1) and (G.FDBH in (1)) and G.FDBH=1 and B.BMDM like '010101030501%' and G.RQ >=to_date('2017-9-6','yyyy-mm-dd') and G.RQ <= to_date('2017-10-25','yyyy-mm-dd') and ((B.BMDM like '0101010304%') or (B.BMDM like '0101010305%') or (B.BMDM like '0101010404%') or (B.BMDM like '0101010405%') or (B.BMDM like '0101010407%')) group by G.SB,S.NAME,M.BMDM,M.DEPT_NAME having (SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE)<>0 OR SUM(nvl(G.XSCB_HS,0)+nvl(G.XSCB_YG_HS,0)+nvl(G.WRZXSCB_CL_HS,0)+nvl(G.WRZXSCB_YG_HS,0))<>0) ORDER BY G.SB,S.NAME,M.BMDM,M.DEPT_NAME

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33282',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

34. 20171026
5bdfyq0q6hh0z

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE)) 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/count(distinct C.SKTNO||to_char(C.JLBH))),2) 票单价 , SUM(C.XSSL) 销售数量 , round(DECODE(SUM(C.XSSL),0,0,SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/SUM(C.XSSL)),2) 件单价 , round(DECODE(SUM(C.XSSL),0,0,sum(S.SKJE)/SUM(C.XSSL)),2) 含券件单价 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, sum(S.SKJE)/count(distinct C.SKTNO||to_char(C.JLBH))),2) 含券票单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2016/1/1','yyyy-mm-dd') and R.RQ<=to_date('2016/10/25','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X , SKFS F
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and S.SKFS=F.CODE and L.JZRQ >=to_date('2016/1/1','yyyy-mm-dd') and L.JZRQ <=to_date('2016/10/25','yyyy-mm-dd') and B.BMDM like '01010201%' and B.FDBH in (1) and (B.FDBH in (1,2)) and ((B.BMDM like '010101%') or (B.BMDM like '010102%') or (B.BMDM like '010201%') or (B.BMDM like '010202%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33283',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================


35. 20171026
03s0t2214gtjp

SELECT B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017/9/1','yyyy-mm-dd') and L.RQ<to_date('2017/10/1','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and M.HTH =6690300 and L.RQ >=to_date('2017/9/1','yyyy-mm-dd') and L.RQ <=to_date('2017/9/30','yyyy-mm-dd') GROUP BY B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33284',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================


36. 20171026
03s0t2214gtjp

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/9/1','yyyy-mm-dd') and G.RQ<to_date('2017/10/26','yyyy-mm-dd') and B.BMDM LIKE '01020104%' and M.MCID in (2) and M.MCID in (2) AND B.FDBH=M.MCID and ((B.BMDM like '010201%') or (B.BMDM like '0102990102%')) GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33286',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

37. 20171030
c4ud544nnxm5a

select *
from (
select ROW_NUMBER() OVER (order by c.hth desc ) as id, c.hth,ht.ydhth,x.spcode,x.name, sum(((1-abs(sign(M.YWLX-10)))+(1-abs(sign(M.YWLX-13))))*M.SL) SL, sum(((1-abs(sign(M.YWLX-30)))+(1-abs(sign(M.YWLX-36)))+(1-abs(sign(M.YWLX-32)))+(1-abs(sign(M.YWLX-29))))*M.JE) JE
from spjxcr s,spjxcr_xm m,spxx_mc c,ht,spxx x,wldw w
WHERE S.id=m.id and S.fdbh=c.mcid and S.sp_id=c.sp_id and c.hth=ht.hth and S.sp_id=x.sp_id and ht.GHDWDM=w.CODE and S.rq between to_date(:tb_begindate,'yyyy-MM-dd') and to_date(:tb_enddate,'yyyy-MM-dd') GROUP BY c.hth,ht.ydhth,x.spcode,x.name ) Tab
where Tab.id between :startIndex and :endIndex

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33397',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================


38. 20171030
gac7pkadmwf4a

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017/10/1','yyyy-mm-dd') and G.RQ<to_date('2017/10/30','yyyy-mm-dd') and B.BMDM LIKE '01020201%' and M.MCID in (2) and M.MCID in (2) AND B.FDBH=M.MCID and ((B.BMDM like '010202%')) and M.HTH =10140000 GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33400',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

39. 20171030
56ahxtvgtshfd

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/10/1','yyyy-mm-dd') and G.RQ<to_date('2017/10/30','yyyy-mm-dd') and B.BMDM LIKE '010202%' and M.MCID in (2) and M.MCID in (2) AND B.FDBH=M.MCID and ((B.BMDM like '010202%')) and M.HTH =10140000 GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33401',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

40. 20171030
fr7wju26kkx9f

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/10/1','yyyy-mm-dd') and G.RQ<to_date('2017/10/30','yyyy-mm-dd') and B.BMDM LIKE '010202%' and M.MCID in (2) and M.MCID in (2) AND B.FDBH=M.MCID and ((B.BMDM like '010202%')) and M.HTH =10140000 GROUP BY B.BMDM,X.SPCODE

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33405',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

41. 20171030
bg5qnm5bs34tb

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , sum(G.JCJE_SQ) 期初库存
from SPZHSJR G , BM B , BM M , SPSB S
where G.DEPTID=B.DEPTID and substr(B.BMDM,1,10)=M.BMDM and length(M.BMDM)=10 and G.SB=S.SBID and B.BMDM like '01010201%' and G.RQ >= '2017-10-1' and G.RQ < '2017-10-2' and G.FDBH in (1) and (G.FDBH in (1,2,3)) and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33406',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

42. 20171030
93xab72bbvj7g

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , sum(G.JCJE) 库存金额 , sum(G.JCSL) 库存数量
from SPZHSJR G , BM B , BM M , SPSB S
where G.DEPTID=B.DEPTID and substr(B.BMDM,1,10)=M.BMDM and length(M.BMDM)=10 and G.SB=S.SBID and B.BMDM like '01010201%' and G.RQ >= '2017-10-29' and G.RQ < '2017-10-30' and G.FDBH in (1) and (G.FDBH in (1,2,3)) and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) group by M.BMDM,M.DEPT_NAME order by M.BMDM

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33407',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================

43. 20171031
4zk7xswzjj53t

SELECT B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017-1-1','yyyy-mm-dd') and L.RQ<to_date('2017-10-31','yyyy-mm-dd') and B.BMDM LIKE '0101020101%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and L.RQ >=to_date('2017/1/1','yyyy-mm-dd') and L.RQ <=to_date('2017/10/30','yyyy-mm-dd') GROUP BY B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

exec dbms_sqltune.accept_sql_profile(task_name=>'TASK_33434',task_owner=>'SYS',replace=>true,force_match=>true);
#======================================================================================================================================
```

