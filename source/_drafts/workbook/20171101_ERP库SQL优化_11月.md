---
title: ERP库SQL优化_11月总计
date: 2017-11-01
categories:
- workbook
tags:
- sql优化
---

## 调优常用命令
``` perl
# 生成调优SQL PROFILE任务脚本
set serveroutput on
declare
l_tuning_task varchar2(30);
begin
 l_tuning_task := dbms_sqltune.create_tuning_task(sql_id => '&SQL_ID');
 dbms_sqltune.execute_tuning_task(l_tuning_task);
 dbms_output.put_line(l_tuning_task);
end;
/

# 禁用和启用SQL PROFILE
exec dbms_sqltune.alter_sql_profile(name => 'SYS_SQLPROF_015d0b25672e0005', attribute_name => 'status', value => 'disabled')
exec dbms_sqltune.alter_sql_profile(name => 'SYS_SQLPROF_015d0b25672e0005', attribute_name => 'status', value => 'enabled')

# 生成表统计信息
execute dbms_statS.gather_table_stats(ownname => 'BFCRM8', tabname =>'YDTEMP_SKU_TEMP', estimate_percent =>DBMS_STATS.AUTO_SAMPLE_SIZE, method_opt => 'FOR ALL COLUMNS SIZE AUTO', cascade => TRUE);
```

<!-- more -->

## ERP库
``` perl
1. 20171101
fkhjg0kcguf10 (BFAutoRCL.exe)  #需再观察

SELECT (TO_NUMBER(TO_CHAR(A.JYSJ,'hh24'))*100+TO_NUMBER(TO_CHAR(A.JYSJ,'mi'))) JYSJ,M.BMDM, SUM(C.XSJE) XSJE, COUNT(DISTINCT A.SKTNO||TO_CHAR(A.JLBH)) XSBS, SUM(C.ZKJE) ZKJE, SUM(C.XSSL) XSSL
FROM BFBHDD9.SKTXSJL A,BFBHDD9.SKTXSJLC C,BM B,BM M
WHERE A.SKTNO=C.SKTNO AND A.JLBH=C.JLBH AND C.DEPTID=B.DEPTID AND M.BMDM=SUBSTR(B.BMDM,1,2*:B2 ) AND LENGTH(M.BMDM)=2*:B2 AND A.JZRQ=:B1 GROUP BY (TO_NUMBER(TO_CHAR(A.JYSJ,'hh24'))*100+TO_NUMBER(TO_CHAR(A.JYSJ,'mi'))),M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33454', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

2. 20171101
ctumwcyjv51hg (BFAutoRCL.exe) #需再观察

SELECT (TO_NUMBER(TO_CHAR(A.JYSJ,'hh24'))*100+TO_NUMBER(TO_CHAR(A.JYSJ,'mi'))) JYSJ,C.DEPTID, SUBSTR(S.SPFL,1,2*:B1 ) SPFL,S.SB, SUM(C.XSJE) XSJE, COUNT(DISTINCT A.SKTNO||TO_CHAR(A.JLBH)) XSBS, SUM(C.ZKJE) ZKJE, SUM(C.XSSL) XSSL
FROM BFBHDD9.SKTXSJL A,BFBHDD9.SKTXSJLC C,BFBHDD9.SPXX S
WHERE A.SKTNO=C.SKTNO AND A.JLBH=C.JLBH AND A.JZRQ=:B2 AND C.SP_ID=S.SP_ID AND
EXISTS(SELECT 1
FROM BFBHDD9.BM
WHERE DEPTID=C.DEPTID AND LENGTH(BMDM)>=2*:B3 ) AND LENGTH(S.SPFL)>=2*:B1 GROUP BY (TO_NUMBER(TO_CHAR(A.JYSJ,'hh24'))*100+TO_NUMBER(TO_CHAR(A.JYSJ,'mi'))),C.DEPTID,SUBSTR(S.SPFL,1,2*:B1 ),S.SB

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33455', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

3. 20171101
d65cx8p7atc9m

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/10/1','yyyy-mm-dd') and G.RQ<to_date('2017/11/1','yyyy-mm-dd') and B.BMDM LIKE '0102%' and M.MCID in (2) and M.MCID in (2) AND B.FDBH=M.MCID and ((B.BMDM like '0102%') or (B.BMDM like '010205%')) and M.HTH =12645300 GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33457', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

4. 20171101
3jrcyg153bbnw

SELECT L.RQ , B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017/1/1','yyyy-mm-dd') and L.RQ<to_date('2017/11/1','yyyy-mm-dd') and B.BMDM LIKE '0102050101%' and M.MCID in (2) and M.MCID in (2) AND B.FDBH=M.MCID and ((B.BMDM like '010103%') or (B.BMDM like '0102020102%') or (B.BMDM like '010202010215%') or (B.BMDM like '0102020104%') or (B.BMDM like '010205%') or (B.BMDM like '010206%') or (B.BMDM like '010299%')) and L.RQ >=to_date('2017/1/1','yyyy-mm-dd') and L.RQ <=to_date('2017/10/31','yyyy-mm-dd') GROUP BY L.RQ,B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33458', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

5. 20171101
dnrxh1s59jmu3

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017/10/1','yyyy-mm-dd') and G.RQ<to_date('2017/11/1','yyyy-mm-dd') and B.BMDM LIKE '01020201%' and M.MCID in (2) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '0101%') or (B.BMDM like '010103%') or (B.BMDM like '0102%') or (B.BMDM like '010202010215%')) GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33459', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

6. 20171101
bsyvg94du7k0h

select X.SPFL 商品分类代码 , F.NAME 商品分类名称 , X.SPCODE 商品代码 , M.OLD_SPCODE 商品旧码 , X.SP_ID 商品ID , X.BARCODE 条码 , X.PYM 拼音码 , X.NAME 商品名称 , M.ZHJJ 原进价 , M.LSDJ 原售价 ,
(SELECT A.JHDJ_HS
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 and C.FDBH=M.MCID ) AS 促销进价 ,
(SELECT A.LSDJ
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 AND C.FDBH=M.MCID ) AS 促销售价 , (case X.SPTYPE when 0 then '自动单价' when 1 then '手工单价' end) AS 价格类型 , M.SPTX 商品特性ID , '' 商品特性 , B.BMDM 商品销售部门代码 , B.DEPT_NAME 商品销售部门 , DECODE(M.BJ_SPBZ,0,'普通商品',1,'永续商品') 商品标识 , DECODE(M.LSDJ,0,0,ROUND((M.LSDJ-M.CGJ_HS)/M.LSDJ,4)) 加价率 , M.KSRQ 开始时间 , M.JSRQ 结束时间 , DECODE(M.BJ_BCJBD,0,'不参加保底',1,'参加保底') 是否参加保底 , R.NAME 产地名称 , S.NAME 商标 , X.HH 商品货号 , X.SPGG 商品规格 ,
(SELECT L.JSKL
FROM HT_LY_JSKL L
WHERE L.HTH=M.HTH AND L.CODE=M.JSKL_CODE) 结算扣率 , M.JHRQ_SC 首次进货日期 , M.JHRQ_ZH 最后进货日期 , X.SPYT 使用对象 , X.UNIT 计量单位 , M.PFDJ 批发单价 , M.CGJ_HS 含税进货单价 , M.LSDJ 零售单价 , M.HYLSDJ 会员零售价 , X.XXSL*100 "销项税率(%)" , X.JXSL*100 "进项税率(%)" , X.MBHL 统计比例 , M.HTH 合同号 , H.YDHTH 原远大合同号 , decode(X.SPTYPE,'0','品种','1','大类','2','细类','3','出租柜组','4','黄金饰品') 类别 , W.NAME 供货单位 , X.ZLDJ 质量等级 , X.ZDHL 质地含量 , decode(H.HSFS,'0','经销','1','代销','2','出租柜组','3','联营','4','物口','5','租赁') 核算方式 , X.DJRMC 登记人名称 , X.DJRQ 登记日期 , X.ZXRMC 审核人名称 , trunc(X.ZXRQ) 审核日期 , X.GXRMC 最后修改人 , X.GXSJ 最后修改时间 , decode(M.STATUS,'-1','特殊商品','0','正常','1','未审核','2','淘汰','3','新品','4','暂停','5','终止') as 商品状态 , X.TTSJ 淘汰时间 , decode(M.CJSX,0,'进口',1,'国产',2,'合资') 性质 , M.MCID 分店编号 , F.FDMC 门店名称 ,
(select BZHL
from SPBZ B1
where B1.SP_ID=X.SP_ID and ROWNUM=1) 包装含量 , decode(X.SZSPBJ,0,'非散装',1,'称重散装',2,'独立散装','') 散装商品标记 , M.QPZ "去皮重(g)" , X.BZQTS 保质期天数 ,
(SELECT BARCODE
FROM SPBARCODE A
WHERE A.SP_ID=X.SP_ID AND A.LX=4) PLU码 , M.DJSJ_MC 卖场登记时间 , DECODE(X.BJ_MIANCODE,1,'主编码','非主编码') 主编码标记 , DECODE(H.STATUS,'0','未审核','1','转审批','2','审批通过','3','待启动','4','试销','5','正常','6','到期','7','终止','8','清退') As 合同状态 ,
nvl((SELECT NVL(K.KCSL,0) KCSL
FROM SPKC K
WHERE K.SP_ID=X.SP_ID AND K.DEPTID=B.DEPTID),0) AS 库存数量
from SPXX X , SPFL F , SPSB S , WLDW W , REGION R , SPXX_MC M , HT H , FDDEF F , BM B
where X.SPFL=F.SPFL(+) AND M.GHDW=W.CODE(+) AND M.DEPTID_XS=B.DEPTID and M.CDDM=R.CODE(+) and X.SB=S.SBID and X.SP_ID=M.SP_ID(+) AND M.HTH=H.HTH AND M.MCID=F.FDBH and (M.STATUS in (0,1)) and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and M.MCID in (1,2,3) and M.MCID in (1,2,3) order by X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33461', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

7. 20171101
cckm3r3q9j240 （优化失败，优化后效率比较差）

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , 0 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , 0 票单价 ,
(select sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13))) )*I.SL)
from SPJXCR_XM I,SPJXCR R
WHERE I.ID=R.ID AND R.SP_ID=C.SP_ID AND R.DEPTID=B.DEPTID and RQ>='2017/10/1' and RQ<='2017/10/31') 销售数量 , 0 件单价 , 0 含券票单价 , 0 含券件单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2017/10/1','yyyy-mm-dd') and R.RQ<=to_date('2017/10/31','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and L.JZRQ >=to_date('2017/10/1','yyyy-mm-dd') and L.JZRQ <=to_date('2017/10/31','yyyy-mm-dd') and B.BMDM like '0102%' and B.FDBH in (2) and (B.FDBH in (1,2)) and ((B.BMDM like '01%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID,C.SP_ID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33462', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

8. 20171101
7nw0s82cuw7tn

select M1.BMDM||'小计' 部门代码 , M1.DEPT_NAME||'小计' 部门名称 , ' ' 类型 , sum(S.SKJE) 含券销售 , SUM(decode(K.YDCW_JK,1,1,0)*S.SKJE) 去券销售 , SUM(decode(K.YDCW_JK,0,1,0)*S.SKJE) 其中礼券
from SKTXSJLC C , SKTXSJLC_SKFS S , SKTXSJL L , BM B , BM M1 , SPXX_MC M , SKFS K
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH AND C.SP_ID=M.SP_ID AND B.FDBH=M.MCID AND S.SKFS=K.CODE and substr(B.BMDM,1,8)=M1.BMDM and L.JZRQ >=to_date('2017/10/1','yyyy-mm-dd') and L.JZRQ <to_date('2017-11-1','yyyy-mm-dd') and B.BMDM like '010202%' and B.FDBH in (2) and (B.FDBH in (1,2)) and ((B.BMDM like '0101%') or (B.BMDM like '0102%')) group by M1.BMDM,M1.DEPT_NAME order by M1.BMDM,M1.DEPT_NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33466', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

9. 20171101
da330cb5cg7z3

select M1.BMDM||'小计' 部门代码 , M1.DEPT_NAME||'小计' 部门名称 , ' ' 类型 , sum(S.SKJE) 含券销售 , SUM(decode(K.YDCW_JK,1,1,0)*S.SKJE) 去券销售 , SUM(decode(K.YDCW_JK,0,1,0)*S.SKJE) 其中礼券
from SKTXSJLC C , SKTXSJLC_SKFS S , SKTXSJL L , BM B , BM M1 , SPXX_MC M , SKFS K
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH AND C.SP_ID=M.SP_ID AND B.FDBH=M.MCID AND S.SKFS=K.CODE and substr(B.BMDM,1,8)=M1.BMDM and L.JZRQ >=to_date('2017/8/1','yyyy-mm-dd') and L.JZRQ <to_date('2017-9-1','yyyy-mm-dd') and B.BMDM like '0102%' and (M.HSFS in (0,3)) and B.FDBH in (2) and (B.FDBH in (2)) and ((B.BMDM like '0102%') or (B.BMDM like '010205%')) group by M1.BMDM,M1.DEPT_NAME order by M1.BMDM,M1.DEPT_NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33468', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

10. 20171101
8bgpw1cx6vjyn   

SELECT L.RQ , B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017/10/1','yyyy-mm-dd') and L.RQ<to_date('2017/11/1','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%')) and M.HTH =5553000 and L.RQ >=to_date('2017/10/1','yyyy-mm-dd') and L.RQ <=to_date('2017/10/31','yyyy-mm-dd') GROUP BY L.RQ,B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33470', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

11. 20171102
5z0dmqcwx82ax   

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017/10/1','yyyy-mm-dd') and G.RQ<to_date('2017/11/1','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and M.HTH =6690300 GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33494', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

12. 20171102
1vw2jhxjpk9a4   

SELECT B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017-10-1','yyyy-mm-dd') and L.RQ<to_date('2017-11-1','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and L.RQ >=to_date('2017/10/1','yyyy-mm-dd') and L.RQ <=to_date('2017/10/31','yyyy-mm-dd') GROUP BY B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33495', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

13. 20171102
9xmhw4kgrykgm   

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_返点B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_返点A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群美妆币E" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群欢庆币" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0))4 as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,4)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-10-31' and B.BMDM LIKE '01010201%' and ((B.BMDM like '01%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33499', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

14. 20171102
9j1knj62spgc8   

SELECT B.BMDM , B.DEPT_NAME BMMC , X.SPCODE , X.NAME , K.JSKL*100 JSKL ,
(SELECT JSKL*100
FROM HT_LY_JSKL
WHERE HTH=M.HTH AND CODE=0) JSKL_HT , M.HTH , W.NAME 供货商名称 , decode(M.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') HSFS , X.JXSL , X.XXSL , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ) as XSJE , (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as ML , round( decode((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) ),0,0,((sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE))-sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)))/ (sum((1-abs(sign(I.YWLX-30)))*I.JE)+sum((1-abs(sign(I.YWLX-36)))*I.JE) +sum((1-abs(sign(I.YWLX-32)))*I.JE)+sum((1-abs(sign(I.YWLX-29)))*I.JE) )*100),2) as MLL , sum((1-abs(sign(I.YWLX-32)))*I.JE+(1-abs(sign(I.YWLX-29)))*I.JE) YHJE , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*(I.JE+I.SJ)) as XSCB , sum(((1-abs(sign(I.YWLX-10)))+(1-abs(sign(I.YWLX-13)))+(1-abs(sign(I.YWLX-14)))+(1-abs(sign(I.YWLX-15))))*I.JE) as XSCB_BHS , sum((1-abs(sign(I.YWLX-31)))*I.JE+(1-abs(sign(I.YWLX-37)))*I.JE) ZKJE , 0 XSJE_CW , 0 XSJE_CWQ , (sum((1-abs(sign(I.YWLX-10)))*I.SL)+sum((1-abs(sign(I.YWLX-13)))*I.SL)) as XSSL , M.MCID
from SPJXCR L , SPJXCR_XM I , SPXX X , SPXX_MC M , BM B , HT H , HT_LY_JSKL K , WLDW W
where L.ID=I.ID AND L.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and L.FDBH=M.MCID and L.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and I.YWLX in (10,29,30,32,36,13,14,15,31,37) and M.HTH=H.HTH and M.HTH=K.HTH(+) and M.JSKL_CODE=K.CODE(+) AND H.GHDWDM=W.CODE and L.RQ>=to_date('2017-1-1','yyyy-mm-dd') and L.RQ<to_date('2017-2-1','yyyy-mm-dd') and B.BMDM LIKE '010102010214%' and M.MCID in (1) and M.MCID in (1) AND B.FDBH=M.MCID and ((B.BMDM like '010102010208%') or (B.BMDM like '010102010212%') or (B.BMDM like '010102010214%') or (B.BMDM like '010102010215%') or (B.BMDM like '010103%')) and L.RQ >=to_date('2017/1/1','yyyy-mm-dd') and L.RQ <=to_date('2017/1/31','yyyy-mm-dd') GROUP BY B.BMDM,B.DEPT_NAME,X.SPCODE,X.NAME,M.HTH,W.NAME,M.MCID,M.HSFS,X.JXSL,X.XXSL,X.SP_ID,L.DEPTID,H.JSKL,K.JSKL

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33502', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

15. 20171103
09u335j1j0gj9   

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/10/2','yyyy-mm-dd') and G.RQ<to_date('2017/11/3','yyyy-mm-dd') and B.BMDM LIKE '010202%' and M.MCID in (2) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '0101020102%') or (B.BMDM like '0102020102%') or (B.BMDM like '01020202%') or (B.BMDM like '010302%')) and M.HTH =10184300 GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33522', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

16. 20171103
4pgb83h7jqmxd   

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_返点B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_返点A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群美妆币E" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群欢庆币" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,12)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-10-1' and S.RQ <= '2017-10-31' and B.BMDM LIKE '010202%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%')) and B.FDBH in (2) and (S.FDBH in (1,2)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33523', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

17. 20171103
9j9uqksnu5fu9  

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE)) 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/count(distinct C.SKTNO||to_char(C.JLBH))),2) 票单价 , SUM(C.XSSL) 销售数量 , round(DECODE(SUM(C.XSSL),0,0,SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/SUM(C.XSSL)),2) 件单价 , round(DECODE(SUM(C.XSSL),0,0,sum(S.SKJE)/SUM(C.XSSL)),2) 含券件单价 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, sum(S.SKJE)/count(distinct C.SKTNO||to_char(C.JLBH))),2) 含券票单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2016/9/1','yyyy-mm-dd') and R.RQ<=to_date('2017/8/31','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X , SKFS F
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and S.SKFS=F.CODE and L.JZRQ >=to_date('2016/9/1','yyyy-mm-dd') and L.JZRQ <=to_date('2017/8/31','yyyy-mm-dd') and B.BMDM like '0102010204%' and B.FDBH in (2) and (B.FDBH in (2)) and ((B.BMDM like '010201%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33524', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

18. 20171103
292ndm5yp6cqt 

select '' 支付方式ID , '' 支付方式 , F.ZFFSLX 支付代码 , DECODE(F.ZFFSLX,0,'现金',1,'卡券',2,'信用卡','其他')||'小计' 支付类型 , SUM(G.XSJE) 销售金额 , '' 占比
from GHDWSKFSXS G , SKFS F , BM B
where G.SKFS=F.CODE and G.DEPTID=B.DEPTID and B.BMDM like '010202%' and B.FDBH in (2) and (G.FDBH in (1,2)) and ((B.BMDM like '0101%') or (B.BMDM like '0102%')) and G.RQ >=to_date('2017-10-1','yyyy-mm-dd') and G.RQ <=to_date('2017-10-31','yyyy-mm-dd') GROUP BY F.ZFFSLX order by F.ZFFSLX

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33525', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

19. 20171103
78ggk15s1qv0r

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017-6-29','yyyy-mm-dd') and G.RQ<to_date('2017-10-11','yyyy-mm-dd') and B.BMDM LIKE '01020201%' and M.MCID in (2) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '0101%') or (B.BMDM like '0102%')) GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33528', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

20. 20171103
461aab39xvp3s

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_返点B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_返点A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群美妆币E" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群欢庆币" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-4-1' and S.RQ <= '2017-10-31' and B.BMDM LIKE '010103010204%' and ((B.BMDM like '010102010214%') or (B.BMDM like '010102010215%') or (B.BMDM like '010103%') or (B.BMDM like '010191%') or (B.BMDM like '0101990102%') or (B.BMDM like '010202010215%')) and B.FDBH in (1) and (S.FDBH in (1)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33532', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

20. 20171103
bc3zukq9fquy3

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_返点B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_返点A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群美妆币E" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群欢庆币" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,4)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-4-1' and S.RQ <= '2017-10-31' and B.BMDM LIKE '010103010204%' and ((B.BMDM like '010102010214%') or (B.BMDM like '010102010215%') or (B.BMDM like '010103%') or (B.BMDM like '010191%') or (B.BMDM like '0101990102%') or (B.BMDM like '010202010215%')) and B.FDBH in (1) and (S.FDBH in (1)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33533', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

21. 20171106
315qm57zq26zf

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017-10-1','yyyy-mm-dd') and G.RQ<to_date('2017-11-1','yyyy-mm-dd') and B.BMDM LIKE '0102%' and M.MCID in (2) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '01%')) and M.HTH =13359300 GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33619', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

22. 20171106
7mzd9gzrhp7ua

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_返点B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_返点A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群美妆币E" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群欢庆币" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-10-31' and B.BMDM LIKE '01020201%' and ((B.BMDM like '0102%') or (B.BMDM like '010202010215%') or (B.BMDM like '010205%')) and B.FDBH in (2) and (S.FDBH in (2)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33620', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

23. 20171106
3n384kgqyx664

select X.SPFL 商品分类代码 , F.NAME 商品分类名称 , X.SPCODE 商品代码 , M.OLD_SPCODE 商品旧码 , X.SP_ID 商品ID , X.BARCODE 条码 , X.PYM 拼音码 , X.NAME 商品名称 , M.ZHJJ 原进价 , M.LSDJ 原售价 ,
(SELECT A.JHDJ_HS
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 and C.FDBH=M.MCID ) AS 促销进价 ,
(SELECT A.LSDJ
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 AND C.FDBH=M.MCID ) AS 促销售价 , (case X.SPTYPE when 0 then '自动单价' when 1 then '手工单价' end) AS 价格类型 , M.SPTX 商品特性ID , '' 商品特性 , B.BMDM 商品销售部门代码 , B.DEPT_NAME 商品销售部门 , DECODE(M.BJ_SPBZ,0,'普通商品',1,'永续商品') 商品标识 , DECODE(M.LSDJ,0,0,ROUND((M.LSDJ-M.CGJ_HS)/M.LSDJ,4)) 加价率 , M.KSRQ 开始时间 , M.JSRQ 结束时间 , DECODE(M.BJ_BCJBD,0,'不参加保底',1,'参加保底') 是否参加保底 , R.NAME 产地名称 , S.NAME 商标 , X.HH 商品货号 , X.SPGG 商品规格 ,
(SELECT L.JSKL
FROM HT_LY_JSKL L
WHERE L.HTH=M.HTH AND L.CODE=M.JSKL_CODE) 结算扣率 , M.JHRQ_SC 首次进货日期 , M.JHRQ_ZH 最后进货日期 , X.SPYT 使用对象 , X.UNIT 计量单位 , M.PFDJ 批发单价 , M.CGJ_HS 含税进货单价 , M.LSDJ 零售单价 , M.HYLSDJ 会员零售价 , X.XXSL*100 "销项税率(%)" , X.JXSL*100 "进项税率(%)" , X.MBHL 统计比例 , M.HTH 合同号 , H.YDHTH 原远大合同号 , decode(X.SPTYPE,'0','品种','1','大类','2','细类','3','出租柜组','4','黄金饰品') 类别 , W.NAME 供货单位 , X.ZLDJ 质量等级 , X.ZDHL 质地含量 , decode(H.HSFS,'0','经销','1','代销','2','出租柜组','3','联营','4','物口','5','租赁') 核算方式 , X.DJRMC 登记人名称 , X.DJRQ 登记日期 , X.ZXRMC 审核人名称 , trunc(X.ZXRQ) 审核日期 , X.GXRMC 最后修改人 , X.GXSJ 最后修改时间 , decode(M.STATUS,'-1','特殊商品','0','正常','1','未审核','2','淘汰','3','新品','4','暂停','5','终止') as 商品状态 , X.TTSJ 淘汰时间 , decode(M.CJSX,0,'进口',1,'国产',2,'合资') 性质 , M.MCID 分店编号 , F.FDMC 门店名称 ,
(select BZHL
from SPBZ B1
where B1.SP_ID=X.SP_ID and ROWNUM=1) 包装含量 , decode(X.SZSPBJ,0,'非散装',1,'称重散装',2,'独立散装','') 散装商品标记 , M.QPZ "去皮重(g)" , X.BZQTS 保质期天数 ,
(SELECT BARCODE
FROM SPBARCODE A
WHERE A.SP_ID=X.SP_ID AND A.LX=4) PLU码 , M.DJSJ_MC 卖场登记时间 , DECODE(X.BJ_MIANCODE,1,'主编码','非主编码') 主编码标记 , DECODE(H.STATUS,'0','未审核','1','转审批','2','审批通过','3','待启动','4','试销','5','正常','6','到期','7','终止','8','清退') As 合同状态 ,
nvl((SELECT NVL(K.KCSL,0) KCSL
FROM SPKC K
WHERE K.SP_ID=X.SP_ID AND K.DEPTID=B.DEPTID),0) AS 库存数量
from SPXX X , SPFL F , SPSB S , WLDW W , REGION R , SPXX_MC M , HT H , FDDEF F , BM B
where X.SPFL=F.SPFL(+) AND M.GHDW=W.CODE(+) AND M.DEPTID_XS=B.DEPTID and M.CDDM=R.CODE(+) and X.SB=S.SBID and X.SP_ID=M.SP_ID(+) AND M.HTH=H.HTH AND M.MCID=F.FDBH and (M.STATUS in (0,1,2,3,4,5,6,-1)) and X.SZSPBJ in (1,2) and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and M.MCID in (1,2,3) and M.MCID in (1,2,3) order by X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33627', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

24. 20171107
djkahr0t5n5ur

select X.SPFL 商品分类代码 , F.NAME 商品分类名称 , X.SPCODE 商品代码 , M.OLD_SPCODE 商品旧码 , X.SP_ID 商品ID , X.BARCODE 条码 , X.PYM 拼音码 , X.NAME 商品名称 , M.ZHJJ 原进价 , M.LSDJ 原售价 ,
(SELECT A.JHDJ_HS
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 and C.FDBH=M.MCID ) AS 促销进价 ,
(SELECT A.LSDJ
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 AND C.FDBH=M.MCID ) AS 促销售价 , (case X.SPTYPE when 0 then '自动单价' when 1 then '手工单价' end) AS 价格类型 , M.SPTX 商品特性ID , '' 商品特性 , B.BMDM 商品销售部门代码 , B.DEPT_NAME 商品销售部门 , DECODE(M.BJ_SPBZ,0,'普通商品',1,'永续商品') 商品标识 , DECODE(M.LSDJ,0,0,ROUND((M.LSDJ-M.CGJ_HS)/M.LSDJ,4)) 加价率 , M.KSRQ 开始时间 , M.JSRQ 结束时间 , DECODE(M.BJ_BCJBD,0,'不参加保底',1,'参加保底') 是否参加保底 , R.NAME 产地名称 , S.NAME 商标 , X.HH 商品货号 , X.SPGG 商品规格 ,
(SELECT L.JSKL
FROM HT_LY_JSKL L
WHERE L.HTH=M.HTH AND L.CODE=M.JSKL_CODE) 结算扣率 , M.JHRQ_SC 首次进货日期 , M.JHRQ_ZH 最后进货日期 , X.SPYT 使用对象 , X.UNIT 计量单位 , M.PFDJ 批发单价 , M.CGJ_HS 含税进货单价 , M.LSDJ 零售单价 , M.HYLSDJ 会员零售价 , X.XXSL*100 "销项税率(%)" , X.JXSL*100 "进项税率(%)" , X.MBHL 统计比例 , M.HTH 合同号 , H.YDHTH 原远大合同号 , decode(X.SPTYPE,'0','品种','1','大类','2','细类','3','出租柜组','4','黄金饰品') 类别 , W.NAME 供货单位 , X.ZLDJ 质量等级 , X.ZDHL 质地含量 , decode(H.HSFS,'0','经销','1','代销','2','出租柜组','3','联营','4','物口','5','租赁') 核算方式 , X.DJRMC 登记人名称 , X.DJRQ 登记日期 , X.ZXRMC 审核人名称 , trunc(X.ZXRQ) 审核日期 , X.GXRMC 最后修改人 , X.GXSJ 最后修改时间 , decode(M.STATUS,'-1','特殊商品','0','正常','1','未审核','2','淘汰','3','新品','4','暂停','5','终止') as 商品状态 , X.TTSJ 淘汰时间 , decode(M.CJSX,0,'进口',1,'国产',2,'合资') 性质 , M.MCID 分店编号 , F.FDMC 门店名称 ,
(select BZHL
from SPBZ B1
where B1.SP_ID=X.SP_ID and ROWNUM=1) 包装含量 , decode(X.SZSPBJ,0,'非散装',1,'称重散装',2,'独立散装','') 散装商品标记 , M.QPZ "去皮重(g)" , X.BZQTS 保质期天数 ,
(SELECT BARCODE
FROM SPBARCODE A
WHERE A.SP_ID=X.SP_ID AND A.LX=4) PLU码 , M.DJSJ_MC 卖场登记时间 , DECODE(X.BJ_MIANCODE,1,'主编码','非主编码') 主编码标记 , DECODE(H.STATUS,'0','未审核','1','转审批','2','审批通过','3','待启动','4','试销','5','正常','6','到期','7','终止','8','清退') As 合同状态 ,
nvl((SELECT NVL(K.KCSL,0) KCSL
FROM SPKC K
WHERE K.SP_ID=X.SP_ID AND K.DEPTID=B.DEPTID),0) AS 库存数量
from SPXX X , SPFL F , SPSB S , WLDW W , REGION R , SPXX_MC M , HT H , FDDEF F , BM B
where X.SPFL=F.SPFL(+) AND M.GHDW=W.CODE(+) AND M.DEPTID_XS=B.DEPTID and M.CDDM=R.CODE(+) and X.SB=S.SBID and X.SP_ID=M.SP_ID(+) AND M.HTH=H.HTH AND M.MCID=F.FDBH and (M.STATUS in (2)) AND B.BMDM LIKE '01010201%' and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and M.MCID in (1) and M.MCID in (1) order by X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33648', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

25. 20171107
723b9xbukkz3q

SELECT G.SB 品牌ID , S.NAME 品牌名称 , M.BMDM 部门ID , M.DEPT_NAME 部门名称 , NVL(SUM(NVL(G.XSJE,0)),0) 正柜满储券满减券流水
FROM SPSKFSXS G , SPSB S , BM B , BM M , SPXX_MC C , SKFS F
WHERE G.SB=S.SBID AND G.DEPTID=B.DEPTID AND G.SP_ID=C.SP_ID AND G.FDBH=C.MCID AND G.SKFS=F.CODE AND F.BJ_QYHQ=1 AND NVL(C.BJ_GWSX,0)=0 and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and G.FDBH in (1) and (G.FDBH in (1,2,3)) and G.FDBH=1 and B.BMDM like '0101%' and G.RQ >=to_date('2017/10/1','yyyy-mm-dd') and G.RQ <= to_date('2017/10/31','yyyy-mm-dd') and ((B.BMDM like '01%')) and G.SB=6910 group by G.SB,S.NAME,M.BMDM,M.DEPT_NAME having SUM(G.XSJE)<>0 ORDER BY G.SB,S.NAME,M.BMDM,M.DEPT_NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33654', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

26. 20171107
4mmmtyxf6fwmu

SELECT G.SB 品牌ID , S.NAME 品牌名称 , M.BMDM 部门ID , M.DEPT_NAME 部门名称 , NVL(SUM(NVL(G.XSJE,0)),0) 全部满储券满减券流水
FROM SPSKFSXS G , SPSB S , BM B , BM M , SKFS F
WHERE G.SB=S.SBID AND G.DEPTID=B.DEPTID AND G.SKFS=F.CODE AND F.BJ_QYHQ=1 and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and G.FDBH in (1) and (G.FDBH in (1,2,3)) and G.FDBH=1 and B.BMDM like '0101%' and G.RQ >=to_date('2017/10/1','yyyy-mm-dd') and G.RQ <= to_date('2017/10/31','yyyy-mm-dd') and ((B.BMDM like '01%')) and G.SB=6910 group by G.SB,S.NAME,M.BMDM,M.DEPT_NAME having SUM(G.XSJE)<>0 ORDER BY G.SB,S.NAME,M.BMDM,M.DEPT_NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33655', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================


27. 20171110
0tsdma9547zc8

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_宝姿返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_返点B" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_返点A" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_群店庆币A" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群周年庆情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_预存礼金" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群美妆币E" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群欢庆币" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-9-30' and B.BMDM LIKE '01010201%' and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) and B.FDBH in (1) and (S.FDBH in (1,2,3)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33735', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

28. 20171114
0tsdma9547zc8

SELECT G.RQ , B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/8/1','yyyy-mm-dd') and G.RQ<to_date('2017/9/1','yyyy-mm-dd') and X.NAME LIKE '%音儿%' and B.BMDM LIKE '0102%' and M.MCID in (2) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '010101%') or (B.BMDM like '010102%') or (B.BMDM like '010201%') or (B.BMDM like '010202%')) GROUP BY G.RQ,B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33838', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

29. 20171114
fd7guyyjgru5u

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017/8/1','yyyy-mm-dd') and G.RQ<to_date('2017/9/1','yyyy-mm-dd') and X.NAME LIKE '%诗篇%' and B.BMDM LIKE '0102%' and M.MCID in (2) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '010101%') or (B.BMDM like '010102%') or (B.BMDM like '010201%') or (B.BMDM like '010202%')) GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_33839', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

30. 20171129

select '' 支付方式ID , '' 支付方式 , F.ZFFSLX 支付代码 , DECODE(F.ZFFSLX,0,'现金',1,'卡券',2,'信用卡','其他')||'小计' 支付类型 , SUM(G.XSJE) 销售金额 , '' 占比
from GHDWSKFSXS G , SKFS F , BM B
where G.SKFS=F.CODE and G.DEPTID=B.DEPTID and B.BMDM like '01020201%' and B.FDBH in (2) and (G.FDBH in (1,2)) and ((B.BMDM like '0101%') or (B.BMDM like '010103%') or (B.BMDM like '0102%') or (B.BMDM like '010202010215%') or (B.BMDM like '01020603%')) and G.RQ >=to_date('2017/11/1','yyyy-mm-dd') and G.RQ <=to_date('2017/11/28','yyyy-mm-dd') GROUP BY F.ZFFSLX order by F.ZFFSLX

exec dbms_sqltune.accept_sql_profile(task_name => 'TASK_34241', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================



```


## CRM库
``` perl


```