---
title: 数据库SQL优化_12月总计
date: 2017-12-04
categories:
- workbook
tags:
- sql优化
---

## 调优常用命令
``` perl
# 生成调优SQL PROFILE任务脚本
set serveroutput on
declare
l_tuning_task varchar2(30);
begin
 l_tuning_task := dbms_sqltune.create_tuning_task(sql_id => '&SQL_ID');
 dbms_sqltune.execute_tuning_task(l_tuning_task);
 dbms_output.put_line(l_tuning_task);
end;
/

# 禁用和启用SQL PROFILE
exec dbms_sqltune.alter_sql_profile(name => 'SYS_SQLPROF_015d0b25672e0005', attribute_name => 'status', value => 'disabled')
exec dbms_sqltune.alter_sql_profile(name => 'SYS_SQLPROF_015d0b25672e0005', attribute_name => 'status', value => 'enabled')

# 生成表统计信息
execute dbms_statS.gather_table_stats(ownname => 'BFCRM8', tabname =>'YDTEMP_SKU_TEMP', estimate_percent =>DBMS_STATS.AUTO_SAMPLE_SIZE, method_opt => 'FOR ALL COLUMNS SIZE AUTO', cascade => TRUE);
```

<!-- more -->

## ERP库
``` perl
1. 20171204
60ruuvmdsuc1k

SELECT decode(A.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') as 属性 , A.HTH 合同号 ,
(SELECT NAME
FROM HT_SPSB HP,SPSB
WHERE HP.SPSB=SPSB.SBID and HP.HTH=A.HTH AND HP.ZYBJ=1) AS 主营商标 , M.BMDM||M.DEPT_NAME as 部门名称 , C.CODE 供货单位代码 , C.NAME as 供货单位名称 , SUM(A.JCJE_HS) AS 库存金额 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE) AS 销售额 , SUM(A.XSSL+A.WRZXSSL) 销售数量 , SUM(A.XSCB+nvl(A.XSCB_YG,0)+nvl(A.WRZXSCB_CL,0)+nvl(A.WRZXSCB_YG,0)) AS 不含税销售成本 , SUM(A.XSCB_HS+nvl(A.XSCB_YG_HS,0)+nvl(A.WRZXSCB_CL_HS,0)+nvl(A.WRZXSCB_YG_HS,0)) AS 含税销售成本 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) AS 毛利 , ROUND(TO_NUMBER(decode(SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE),0,0, SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) /SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE)))*100,2) AS "毛利率%"
FROM GHDWJXCR A , BM B , WLDW C , BM M , HT H
WHERE B.DEPTID = A.DEPTID AND A.CODE = C.CODE AND A.HTH=H.HTH and A.DEPTID=B.DEPTID and substr(B.BMDM,1,10)=M.BMDM and length(M.BMDM)=10 and B.BMDM like '01020201%' and A.RQ >=to_date('2017-1-1','yyyy-mm-dd') and A.RQ <=to_date('2017-11-30','yyyy-mm-dd') and A.CODE= '004380' and B.FDBH in (2) and (B.FDBH in (1,2,3)) and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) GROUP BY M.BMDM,M.DEPT_NAME,C.CODE,C.NAME,A.HSFS,A.HTH

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34383', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

2. 20171204
g14tn46gj1jsk

SELECT decode(A.HSFS,0,'经销',1,'代销',3,'联营',5,'租赁') as 属性 , A.HTH 合同号 ,
(SELECT NAME
FROM HT_SPSB HP,SPSB
WHERE HP.SPSB=SPSB.SBID and HP.HTH=A.HTH AND HP.ZYBJ=1) AS 主营商标 , M.BMDM||M.DEPT_NAME as 部门名称 , C.CODE 供货单位代码 , C.NAME as 供货单位名称 , SUM(A.JCJE_HS) AS 库存金额 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE) AS 销售额 , SUM(A.XSSL+A.WRZXSSL) 销售数量 , SUM(A.XSCB+nvl(A.XSCB_YG,0)+nvl(A.WRZXSCB_CL,0)+nvl(A.WRZXSCB_YG,0)) AS 不含税销售成本 , SUM(A.XSCB_HS+nvl(A.XSCB_YG_HS,0)+nvl(A.WRZXSCB_CL_HS,0)+nvl(A.WRZXSCB_YG_HS,0)) AS 含税销售成本 , SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) AS 毛利 , ROUND(TO_NUMBER(decode(SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE),0,0, SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE-A.XSCB_HS-nvl(A.XSCB_YG_HS,0)-nvl(A.WRZXSCB_CL_HS,0)-nvl(A.WRZXSCB_YG_HS,0)) /SUM(A.XSJE+A.WRZXSJE+A.YHJE+A.WRZYHJE)))*100,2) AS "毛利率%"
FROM GHDWJXCR A , BM B , WLDW C , BM M , HT H
WHERE B.DEPTID = A.DEPTID AND A.CODE = C.CODE AND A.HTH=H.HTH and A.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and B.BMDM like '0101020102%' and A.RQ >=to_date('2017-11-1','yyyy-mm-dd') and A.RQ <=to_date('2017-11-30','yyyy-mm-dd') and A.CODE= '004521' and B.FDBH in (1) and (B.FDBH in (1,2)) and ((B.BMDM like '010102%') or (B.BMDM like '010202%')) GROUP BY M.BMDM,M.DEPT_NAME,C.CODE,C.NAME,A.HSFS,A.HTH

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34388', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

3. 20171205
bgr1rb9j39ny4

select X.SPFL 商品分类代码 , F.NAME 商品分类名称 , X.SPCODE 商品代码 , M.OLD_SPCODE 商品旧码 , X.SP_ID 商品ID , X.BARCODE 条码 , X.PYM 拼音码 , X.NAME 商品名称 , M.ZHJJ 原进价 , M.LSDJ 原售价 ,
(SELECT A.JHDJ_HS
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 and C.FDBH=M.MCID ) AS 促销进价 ,
(SELECT A.LSDJ
FROM SPCXDITEM A,SPCXD C
WHERE A.JLBH=C.JLBH AND A.SP_ID=X.SP_ID AND C.STATUS=4 AND C.FDBH=M.MCID ) AS 促销售价 , (case X.SPTYPE when 0 then '自动单价' when 1 then '手工单价' end) AS 价格类型 , M.SPTX 商品特性ID , '' 商品特性 , B.BMDM 商品销售部门代码 , B.DEPT_NAME 商品销售部门 , DECODE(M.BJ_SPBZ,0,'普通商品',1,'永续商品') 商品标识 , DECODE(M.LSDJ,0,0,ROUND((M.LSDJ-M.CGJ_HS)/M.LSDJ,4)) 加价率 , M.KSRQ 开始时间 , M.JSRQ 结束时间 , DECODE(M.BJ_BCJBD,0,'不参加保底',1,'参加保底') 是否参加保底 , R.NAME 产地名称 , S.NAME 商标 , X.HH 商品货号 , X.SPGG 商品规格 ,
(SELECT L.JSKL
FROM HT_LY_JSKL L
WHERE L.HTH=M.HTH AND L.CODE=M.JSKL_CODE) 结算扣率 , M.JHRQ_SC 首次进货日期 , M.JHRQ_ZH 最后进货日期 , X.SPYT 使用对象 , X.UNIT 计量单位 , M.PFDJ 批发单价 , M.CGJ_HS 含税进货单价 , M.LSDJ 零售单价 , M.HYLSDJ 会员零售价 , X.XXSL*100 "销项税率(%)" , X.JXSL*100 "进项税率(%)" , X.MBHL 统计比例 , M.HTH 合同号 , H.YDHTH 原远大合同号 , decode(X.SPTYPE,'0','品种','1','大类','2','细类','3','出租柜组','4','黄金饰品') 类别 , W.NAME 供货单位 , X.ZLDJ 质量等级 , X.ZDHL 质地含量 , decode(H.HSFS,'0','经销','1','代销','2','出租柜组','3','联营','4','物口','5','租赁') 核算方式 , X.DJRMC 登记人名称 , X.DJRQ 登记日期 , X.ZXRMC 审核人名称 , trunc(X.ZXRQ) 审核日期 , X.GXRMC 最后修改人 , X.GXSJ 最后修改时间 , decode(M.STATUS,'-1','特殊商品','0','正常','1','未审核','2','淘汰','3','新品','4','暂停','5','终止') as 商品状态 , X.TTSJ 淘汰时间 , decode(M.CJSX,0,'进口',1,'国产',2,'合资') 性质 , M.MCID 分店编号 , F.FDMC 门店名称 ,
(select BZHL
from SPBZ B1
where B1.SP_ID=X.SP_ID and ROWNUM=1) 包装含量 , decode(X.SZSPBJ,0,'非散装',1,'称重散装',2,'独立散装','') 散装商品标记 , M.QPZ "去皮重(g)" , X.BZQTS 保质期天数 ,
(SELECT BARCODE
FROM SPBARCODE A
WHERE A.SP_ID=X.SP_ID AND A.LX=4) PLU码 , M.DJSJ_MC 卖场登记时间 , DECODE(X.BJ_MIANCODE,1,'主编码','非主编码') 主编码标记 , DECODE(H.STATUS,'0','未审核','1','转审批','2','审批通过','3','待启动','4','试销','5','正常','6','到期','7','终止','8','清退') As 合同状态 ,
nvl((SELECT NVL(K.KCSL,0) KCSL
FROM SPKC K
WHERE K.SP_ID=X.SP_ID AND K.DEPTID=B.DEPTID),0) AS 库存数量
from SPXX X , SPFL F , SPSB S , WLDW W , REGION R , SPXX_MC M , HT H , FDDEF F , BM B
where X.SPFL=F.SPFL(+) AND M.GHDW=W.CODE(+) AND M.DEPTID_XS=B.DEPTID and M.CDDM=R.CODE(+) and X.SB=S.SBID and X.SP_ID=M.SP_ID(+) AND M.HTH=H.HTH AND M.MCID=F.FDBH AND B.BMDM LIKE '01010201%' and ((B.BMDM like '010102%') or (B.BMDM like '010202%')) and M.MCID in (1) and M.MCID in (1) order by X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34418', task_owner => 'SYS', replace => TRUE, force_match => true);

create index IDX_SPCXD_SFJ_LYJ on BFBHDD9.SPCXD("STATUS", "FDBH", "JLBH") tablespace jxc_index;
create index IDX_SPCXDITEM_SJJ_LYJ on BFBHDD9.SPCXDITEM("SP_ID", "JLBH", "JHDJ_HS") tablespace jxc_index;
create index IDX_SPCXDITEM_SJL_LYJ on BFBHDD9.SPCXDITEM("SP_ID", "JLBH", "LSDJ") tablespace jxc_index;
create index IDX_SPBARCODE_SL_LYJ on BFBHDD9.SPBARCODE("SP_ID", "LX") tablespace jxc_index;

#======================================================================================================================================

4. 20171207
fq2dwcyy5qdrd

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID and G.RQ>=to_date('2017-11-1','yyyy-mm-dd') and G.RQ<to_date('2017-12-1','yyyy-mm-dd') and X.NAME LIKE '%SMEG%' and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2,3) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%') or (B.BMDM like '010302%')) GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34467', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

5. 20171207
d2v3hjuvvxpsj

select X.SPCODE 商品代码 , X.BARCODE 商品条码 , X.NAME 商品名称 , X.SPGG 商品规格 , X.UNIT 计量单位 , M.LSDJ 零售单价 , sum(XSSL) 销售数量 , sum(B.XSJE) 销售金额 , sum(B.YHJE) 优惠金额 , sum(B.ZKJE) 折扣金额 , PERSON_NAME 营业员 , M.DEPT_NAME 销售部门
from SPXX X , SKTXSJL A , SKTXSJLC B , SKTXSJLT C , WLDW W , SPXX_MC M , BM M , RYXX R
where A.JLBH = B.JLBH and A.SKTNO = B.SKTNO and B.SP_ID = X.SP_ID and B.DEPTID=M.DEPTID and M.GHDW=W.CODE AND X.SP_ID=M.SP_ID and A.JLBH = C.JLBH and A.SKTNO = C.SKTNO and C.YYY=R.PERSON_ID and A.JZRQ>=to_date('2017.11.25','yy/mm/dd') and A.JZRQ<=to_date('2017.12.03','yy/mm/dd') and
exists(select 1
from BM
where BMDM like '0102%' and DEPTID=B.DEPTID) and B.DEPTID in
(select DEPTID
from BM
where ((BMDM like '0102%'))) and M.MCID in (2) and (M.MCID in (2)) group by X.SPCODE,X.BARCODE,X.NAME,X.SPGG,X.UNIT,M.LSDJ,PERSON_NAME,M.DEPT_NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34469', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

6. 20171209
49kr04dmqtwyn

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_锅具返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆礼金1" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币B" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_美妆币" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,71,1,0)) as "_71_好百客积分券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群员专场情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_店庆红包" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,625,1,0)) as "_625_群美妆礼金A" , sum(S.XSJE*decode(S.SKFS,626,1,0)) as "_626_群美妆礼金B" , sum(S.XSJE*decode(S.SKFS,627,1,0)) as "_627_群美妆礼金C" , sum(S.XSJE*decode(S.SKFS,631,1,0)) as "_631_群百货积分返点" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群10倍返点" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群30倍返点" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , sum(S.XSJE*decode(S.SKFS,1160,1,0)) as "_1160_店庆返点" , sum(S.XSJE*decode(S.SKFS,1161,1,0)) as "_1161_美妆币D" , sum(S.XSJE*decode(S.SKFS,1162,1,0)) as "_1162_美妆礼金2" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,14)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-11-30' and B.BMDM LIKE '0101020102%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0,1,3)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34526', task_owner => 'SYS', replace => TRUE, force_match => true);


#======================================================================================================================================

7. 20171209
06kd66a32tgv2

select M.BMDM 部门代码 , M.DEPT_NAME 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_锅具返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆礼金1" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币B" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_美妆币" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,71,1,0)) as "_71_好百客积分券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群员专场情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_店庆红包" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,625,1,0)) as "_625_群美妆礼金A" , sum(S.XSJE*decode(S.SKFS,626,1,0)) as "_626_群美妆礼金B" , sum(S.XSJE*decode(S.SKFS,627,1,0)) as "_627_群美妆礼金C" , sum(S.XSJE*decode(S.SKFS,631,1,0)) as "_631_群百货积分返点" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群10倍返点" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群30倍返点" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , sum(S.XSJE*decode(S.SKFS,1160,1,0)) as "_1160_店庆返点" , sum(S.XSJE*decode(S.SKFS,1161,1,0)) as "_1161_美妆币D" , sum(S.XSJE*decode(S.SKFS,1162,1,0)) as "_1162_美妆礼金2" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-11-30' and B.BMDM LIKE '0101020102%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34527', task_owner => 'SYS', replace => TRUE, force_match => true);

#======================================================================================================================================


8. 20171209
37xrv3pbtxn8r

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_锅具返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆礼金1" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币B" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_美妆币" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,71,1,0)) as "_71_好百客积分券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群员专场情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_店庆红包" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,625,1,0)) as "_625_群美妆礼金A" , sum(S.XSJE*decode(S.SKFS,626,1,0)) as "_626_群美妆礼金B" , sum(S.XSJE*decode(S.SKFS,627,1,0)) as "_627_群美妆礼金C" , sum(S.XSJE*decode(S.SKFS,631,1,0)) as "_631_群百货积分返点" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群10倍返点" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群30倍返点" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , sum(S.XSJE*decode(S.SKFS,1160,1,0)) as "_1160_店庆返点" , sum(S.XSJE*decode(S.SKFS,1161,1,0)) as "_1161_美妆币D" , sum(S.XSJE*decode(S.SKFS,1162,1,0)) as "_1162_美妆礼金2" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,10)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-11-30' and B.BMDM LIKE '0101020102%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34531', task_owner => 'SYS', replace => TRUE, force_match => true);

#======================================================================================================================================


9. 20171209
3370a8a9c06j2

SELECT 0 顺序 , C.SKTNO , C.JLBH , C.TCKT_INX , M.HSFS , M.JSKL_CODE , X.GLKKH , S.SPCODE , S.XXSL TAX_RATE , S.JXSL , M.CGJ_HS , S.BARCODE , S.NAME SPNAME , C.LSDJ , C.XSSL , C.XSJE ,
(select NAME
from SPSB
where SBID=S.SB) as SBMC , C.ZKJE , X.JZRQ , C.YHJE , X.JYSJ , 0 as SXML , R2.PERSON_NAME as SKY ,
(select R3.PERSON_NAME
from SKTXSJLT T2,RYXX R3
where T2.JLBH=C.JLBH and T2.SKTNO=C.SKTNO and T2.TCKT_INX = C.TCKT_INX and R3.PERSON_ID=T2.YYY) as YYY
FROM SKTXSJL X , SKTXSJLC C , SPXX S , RYXX R2 , SKT T , SPXX_MC M
Where X.JLBH = C.JLBH AND X.SKTNO=C.SKTNO AND C.SP_ID = S.SP_ID AND M.SP_ID=S.SP_ID and R2.PERSON_ID=X.SKY and T.SKTNO=X.SKTNO and X.JZRQ >=to_date('2017.12.08 0:00:00','YYYY.MM.DD HH24:MI:SS') and X.JZRQ <=to_date('2017.12.08 0:00:00','YYYY.MM.DD HH24:MI:SS') and
exists(select 1
from BM
where BMDM like '0101%' and DEPTID=C.DEPTID) and C.DEPTID in
(select DEPTID
from BM
where ((BMDM like '01%') or (BMDM like '0101%') or (BMDM like '010103%') or (BMDM like '0102%') or (BMDM like '010202010215%') or (BMDM like '010205%') or (BMDM like '01020502%') or (BMDM like '01020603%'))) and
exists(select 1
from SKTXSJLM M
where M.SKTNO=X.SKTNO AND M.JLBH=X.JLBH ) and T.POSSRVID in (1) and (T.POSSRVID in (1,2,3))and (M.MCID in (1))

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34561', task_owner => 'SYS', replace => TRUE, force_match => true);

#======================================================================================================================================

10. 20171209
1w2rj373qa1as

SELECT 0 顺序 , C.SKTNO , C.JLBH , C.TCKT_INX , M.HSFS , M.JSKL_CODE , X.GLKKH , S.SPCODE , S.XXSL TAX_RATE , S.JXSL , M.CGJ_HS , S.BARCODE , S.NAME SPNAME , C.LSDJ , C.XSSL , C.XSJE ,
(select NAME
from SPSB
where SBID=S.SB) as SBMC , C.ZKJE , X.JZRQ , C.YHJE , X.JYSJ , 0 as SXML , R2.PERSON_NAME as SKY ,
(select R3.PERSON_NAME
from SKTXSJLT T2,RYXX R3
where T2.JLBH=C.JLBH and T2.SKTNO=C.SKTNO and T2.TCKT_INX = C.TCKT_INX and R3.PERSON_ID=T2.YYY) as YYY
FROM SKTXSJL X , SKTXSJLC C , SPXX S , RYXX R2 , SKT T , SPXX_MC M
Where X.JLBH = C.JLBH AND X.SKTNO=C.SKTNO AND C.SP_ID = S.SP_ID AND M.SP_ID=S.SP_ID and R2.PERSON_ID=X.SKY and T.SKTNO=X.SKTNO and X.JZRQ >=to_date('2017.12.08 0:00:00','YYYY.MM.DD HH24:MI:SS') and X.JZRQ <=to_date('2017.12.08 0:00:00','YYYY.MM.DD HH24:MI:SS') and
exists(select 1
from BM
where BMDM like '0101%' and DEPTID=C.DEPTID) and C.DEPTID in
(select DEPTID
from BM
where ((BMDM like '01%') or (BMDM like '0101%') or (BMDM like '010103%') or (BMDM like '0102%') or (BMDM like '010202010215%') or (BMDM like '010205%') or (BMDM like '01020502%') or (BMDM like '01020603%'))) and
exists(select 1
from SKTXSJLM M
where M.SKTNO=X.SKTNO AND M.JLBH=X.JLBH ) and T.POSSRVID in (1) and (T.POSSRVID in (1,2,3))and (M.MCID in (1))

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34562', task_owner => 'SYS', replace => TRUE, force_match => true);

#======================================================================================================================================

11. 20171210
bzpakt0bjk386

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_锅具返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆礼金1" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币B" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_美妆币" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,71,1,0)) as "_71_好百客积分券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群员专场情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_店庆红包" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,625,1,0)) as "_625_群美妆礼金A" , sum(S.XSJE*decode(S.SKFS,626,1,0)) as "_626_群美妆礼金B" , sum(S.XSJE*decode(S.SKFS,627,1,0)) as "_627_群美妆礼金C" , sum(S.XSJE*decode(S.SKFS,631,1,0)) as "_631_群百货积分返点" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群10倍返点" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群30倍返点" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , sum(S.XSJE*decode(S.SKFS,1160,1,0)) as "_1160_店庆返点" , sum(S.XSJE*decode(S.SKFS,1161,1,0)) as "_1161_美妆币D" , sum(S.XSJE*decode(S.SKFS,1162,1,0)) as "_1162_美妆礼金2" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,6)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-11-30' and B.BMDM LIKE '0101020102%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) and (S.HSFS in (0,1,3)) group by M.BMDM,M.DEPT_NAME order by M.BMDM

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34565', task_owner => 'SYS', replace => TRUE, force_match => true);

#======================================================================================================================================

12. 20171210
4nwms3bs1s7bf

SELECT 0 顺序 , C.SKTNO , C.JLBH , C.TCKT_INX , M.HSFS , M.JSKL_CODE , X.GLKKH , S.SPCODE , S.XXSL TAX_RATE , S.JXSL , M.CGJ_HS , S.BARCODE , S.NAME SPNAME , C.LSDJ , C.XSSL , C.XSJE ,
(select NAME
from SPSB
where SBID=S.SB) as SBMC , C.ZKJE , X.JZRQ , C.YHJE , X.JYSJ , 0 as SXML , R2.PERSON_NAME as SKY ,
(select R3.PERSON_NAME
from SKTXSJLT T2,RYXX R3
where T2.JLBH=C.JLBH and T2.SKTNO=C.SKTNO and T2.TCKT_INX = C.TCKT_INX and R3.PERSON_ID=T2.YYY) as YYY
FROM SKTXSJL X , SKTXSJLC C , SPXX S , RYXX R2 , SKT T , SPXX_MC M
Where X.JLBH = C.JLBH AND X.SKTNO=C.SKTNO AND C.SP_ID = S.SP_ID AND M.SP_ID=S.SP_ID and R2.PERSON_ID=X.SKY and T.SKTNO=X.SKTNO and X.JZRQ >=to_date('2016-12-4 0:00:00','YYYY.MM.DD HH24:MI:SS') and X.JZRQ <=to_date('2017-12-4 0:00:00','YYYY.MM.DD HH24:MI:SS') and X.JYSJ >=to_date('2016-12-4 0:00:00','YYYY.MM.DD HH24:MI:SS') and X.JYSJ <=to_date('2017.12.4 17:25:50','YYYY.MM.DD HH24:MI:SS') and
exists(select 1
from BM
where BMDM like '01010201%' and DEPTID=C.DEPTID) and C.DEPTID in
(select DEPTID
from BM
where ((BMDM like '010102%') or (BMDM like '010202%') or (BMDM like '010302%'))) and
exists(select 1
from SKTXSJLM M
where M.SKTNO=X.SKTNO AND M.JLBH=X.JLBH ) and T.POSSRVID in (1) and (T.POSSRVID in (1,2,3))and (M.MCID in (1))


execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34567', task_owner => 'SYS', replace => TRUE, force_match => true);

考虑运行可以改进物理方案设计的访问指导或者创建推荐的索引。BFBHDD9.SPSB("SBID", "NAME")BFBHDD9.SKTXSJLC("JLBH", "SKTNO")BFBHDD9.SKTXSJLM("SKTNO", "JLBH")
#======================================================================================================================================


13. 20171211
d2hg13m1dp8zu

select M.BMDM||'小计' as 部门代码 , M.DEPT_NAME||'小计' as 部门名称 , SUM(S.XSJE) as XSJE_HQ , sum(S.XSJE*decode(S.SKFS,31,1,0)) as "_31_狂欢返点" , sum(S.XSJE*decode(S.SKFS,32,1,0)) as "_32_锅具返点" , sum(S.XSJE*decode(S.SKFS,33,1,0)) as "_33_好百客礼券" , sum(S.XSJE*decode(S.SKFS,34,1,0)) as "_34_白金生日储" , sum(S.XSJE*decode(S.SKFS,38,1,0)) as "_38_美妆礼金1" , sum(S.XSJE*decode(S.SKFS,49,1,0)) as "_49_美妆币B" , sum(S.XSJE*decode(S.SKFS,50,1,0)) as "_50_美妆币" , sum(S.XSJE*decode(S.SKFS,51,1,0)) as "_51_礼券" , sum(S.XSJE*decode(S.SKFS,52,1,0)) as "_52_礼券A" , sum(S.XSJE*decode(S.SKFS,53,1,0)) as "_53_礼券B" , sum(S.XSJE*decode(S.SKFS,54,1,0)) as "_54_礼券C" , sum(S.XSJE*decode(S.SKFS,55,1,0)) as "_55_礼券D" , sum(S.XSJE*decode(S.SKFS,56,1,0)) as "_56_礼券E" , sum(S.XSJE*decode(S.SKFS,60,1,0)) as "_60_四川料理赠券" , sum(S.XSJE*decode(S.SKFS,71,1,0)) as "_71_好百客积分券" , sum(S.XSJE*decode(S.SKFS,85,1,0)) as "_85_历史抵现" , sum(S.XSJE*decode(S.SKFS,86,1,0)) as "_86_积分抵现" , sum(S.XSJE*decode(S.SKFS,87,1,0)) as "_87_积分可抵现" , sum(S.XSJE*decode(S.SKFS,90,1,0)) as "_90_菲仕乐返点" , sum(S.XSJE*decode(S.SKFS,93,1,0)) as "_93_美发折扣" , sum(S.XSJE*decode(S.SKFS,94,1,0)) as "_94_VIP礼金" , sum(S.XSJE*decode(S.SKFS,95,1,0)) as "_95_团购积分卡" , sum(S.XSJE*decode(S.SKFS,96,1,0)) as "_96_美丽礼品储" , sum(S.XSJE*decode(S.SKFS,97,1,0)) as "_97_认同卡" , sum(S.XSJE*decode(S.SKFS,98,1,0)) as "_98_满福卡" , sum(S.XSJE*decode(S.SKFS,100,1,0)) as "_100_生日储值" , sum(S.XSJE*decode(S.SKFS,343,1,0)) as "_343_群VIP生日劵" , sum(S.XSJE*decode(S.SKFS,344,1,0)) as "_344_银联换卡礼" , sum(S.XSJE*decode(S.SKFS,345,1,0)) as "_345_VIP美发券" , sum(S.XSJE*decode(S.SKFS,346,1,0)) as "_346_黑金专属赠饮" , sum(S.XSJE*decode(S.SKFS,347,1,0)) as "_347_百客赠储卡" , sum(S.XSJE*decode(S.SKFS,348,1,0)) as "_348_群员专场情谊卡" , sum(S.XSJE*decode(S.SKFS,349,1,0)) as "_349_花店券" , sum(S.XSJE*decode(S.SKFS,350,1,0)) as "_350_美食券" , sum(S.XSJE*decode(S.SKFS,482,1,0)) as "_482_白金返点" , sum(S.XSJE*decode(S.SKFS,483,1,0)) as "_483_淑女返点" , sum(S.XSJE*decode(S.SKFS,484,1,0)) as "_484_群25倍返点" , sum(S.XSJE*decode(S.SKFS,485,1,0)) as "_485_美妆币-超市" , sum(S.XSJE*decode(S.SKFS,486,1,0)) as "_486_美团霸王券" , sum(S.XSJE*decode(S.SKFS,512,1,0)) as "_512_群手工水饺券3" , sum(S.XSJE*decode(S.SKFS,513,1,0)) as "_513_群面包房券3" , sum(S.XSJE*decode(S.SKFS,514,1,0)) as "_514_企划活动券" , sum(S.XSJE*decode(S.SKFS,516,1,0)) as "_516_店庆红包" , sum(S.XSJE*decode(S.SKFS,517,1,0)) as "_517_黑金生日礼" , sum(S.XSJE*decode(S.SKFS,518,1,0)) as "_518_保级礼金" , sum(S.XSJE*decode(S.SKFS,519,1,0)) as "_519_白金生日礼" , sum(S.XSJE*decode(S.SKFS,521,1,0)) as "_521_探乐赠额" , sum(S.XSJE*decode(S.SKFS,522,1,0)) as "_522_B招行开业礼" , sum(S.XSJE*decode(S.SKFS,524,1,0)) as "_524_欣悦停车券" , sum(S.XSJE*decode(S.SKFS,525,1,0)) as "_525_群美妆币" , sum(S.XSJE*decode(S.SKFS,526,1,0)) as "_526_群美妆币C" , sum(S.XSJE*decode(S.SKFS,527,1,0)) as "_527_群美妆币D" , sum(S.XSJE*decode(S.SKFS,528,1,0)) as "_528_狂欢节代金券" , sum(S.XSJE*decode(S.SKFS,530,1,0)) as "_530_面包房赠券" , sum(S.XSJE*decode(S.SKFS,538,1,0)) as "_538_群面包房券" , sum(S.XSJE*decode(S.SKFS,542,1,0)) as "_542_蜀悦赠券" , sum(S.XSJE*decode(S.SKFS,543,1,0)) as "_543_火锅赠券" , sum(S.XSJE*decode(S.SKFS,544,1,0)) as "_544_面包房代金券" , sum(S.XSJE*decode(S.SKFS,558,1,0)) as "_558_美丽基金券B" , sum(S.XSJE*decode(S.SKFS,566,1,0)) as "_566_探乐抵值券" , sum(S.XSJE*decode(S.SKFS,571,1,0)) as "_571_美食节2元卡" , sum(S.XSJE*decode(S.SKFS,574,1,0)) as "_574_手工水饺礼券" , sum(S.XSJE*decode(S.SKFS,576,1,0)) as "_576_外卖代金券" , sum(S.XSJE*decode(S.SKFS,578,1,0)) as "_578_蜀悦代金券Z" , sum(S.XSJE*decode(S.SKFS,580,1,0)) as "_580_面包房礼券" , sum(S.XSJE*decode(S.SKFS,583,1,0)) as "_583_顾客回馈券" , sum(S.XSJE*decode(S.SKFS,584,1,0)) as "_584_美丽基金券A" , sum(S.XSJE*decode(S.SKFS,586,1,0)) as "_586_调研面包礼券" , sum(S.XSJE*decode(S.SKFS,587,1,0)) as "_587_美食节体验券" , sum(S.XSJE*decode(S.SKFS,589,1,0)) as "_589_好百客体验券" , sum(S.XSJE*decode(S.SKFS,590,1,0)) as "_590_披萨套餐礼券" , sum(S.XSJE*decode(S.SKFS,592,1,0)) as "_592_好百客代金券" , sum(S.XSJE*decode(S.SKFS,598,1,0)) as "_598_木马赠券" , sum(S.XSJE*decode(S.SKFS,600,1,0)) as "_600_菲仕乐代金A" , sum(S.XSJE*decode(S.SKFS,601,1,0)) as "_601_积分停车劵" , sum(S.XSJE*decode(S.SKFS,603,1,0)) as "_603_黑金茶歇礼" , sum(S.XSJE*decode(S.SKFS,605,1,0)) as "_605_F3代金券" , sum(S.XSJE*decode(S.SKFS,606,1,0)) as "_606_VIP面包券" , sum(S.XSJE*decode(S.SKFS,607,1,0)) as "_607_芒果果酱小份" , sum(S.XSJE*decode(S.SKFS,608,1,0)) as "_608_VIP面包赠券" , sum(S.XSJE*decode(S.SKFS,609,1,0)) as "_609_餐饮储值赠券" , sum(S.XSJE*decode(S.SKFS,611,1,0)) as "_611_岁末招募礼" , sum(S.XSJE*decode(S.SKFS,612,1,0)) as "_612_奇思叔叔纸券" , sum(S.XSJE*decode(S.SKFS,613,1,0)) as "_613_好百客白金券" , sum(S.XSJE*decode(S.SKFS,615,1,0)) as "_615_可可拉储值赠" , sum(S.XSJE*decode(S.SKFS,617,1,0)) as "_617_h双十一抵值券" , sum(S.XSJE*decode(S.SKFS,625,1,0)) as "_625_群美妆礼金A" , sum(S.XSJE*decode(S.SKFS,626,1,0)) as "_626_群美妆礼金B" , sum(S.XSJE*decode(S.SKFS,627,1,0)) as "_627_群美妆礼金C" , sum(S.XSJE*decode(S.SKFS,631,1,0)) as "_631_群百货积分返点" , sum(S.XSJE*decode(S.SKFS,942,1,0)) as "_942_团购认同卡" , sum(S.XSJE*decode(S.SKFS,987,1,0)) as "_987_美丽基金券" , sum(S.XSJE*decode(S.SKFS,993,1,0)) as "_993_美食卡" , sum(S.XSJE*decode(S.SKFS,995,1,0)) as "_995_火锅代金券" , sum(S.XSJE*decode(S.SKFS,996,1,0)) as "_996_蜀悦代金券" , sum(S.XSJE*decode(S.SKFS,999,1,0)) as "_999_vip美食券" , sum(S.XSJE*decode(S.SKFS,1091,1,0)) as "_1091_群10倍返点" , sum(S.XSJE*decode(S.SKFS,1092,1,0)) as "_1092_群30倍返点" , sum(S.XSJE*decode(S.SKFS,1093,1,0)) as "_1093_美甲活动礼券" , sum(S.XSJE*decode(S.SKFS,1094,1,0)) as "_1094_群面包房40" , sum(S.XSJE*decode(S.SKFS,1095,1,0)) as "_1095_群牛排抵值券" , sum(S.XSJE*decode(S.SKFS,1096,1,0)) as "_1096_群超市礼金" , sum(S.XSJE*decode(S.SKFS,1097,1,0)) as "_1097_群百货礼金" , sum(S.XSJE*decode(S.SKFS,1103,1,0)) as "_1103_美食节情谊卡" , sum(S.XSJE*decode(S.SKFS,1108,1,0)) as "_1108_h营运抵扣券" , sum(S.XSJE*decode(S.SKFS,1109,1,0)) as "_1109_海返点B" , sum(S.XSJE*decode(S.SKFS,1110,1,0)) as "_1110_海返点C" , sum(S.XSJE*decode(S.SKFS,1111,1,0)) as "_1111_海返点D" , sum(S.XSJE*decode(S.SKFS,1112,1,0)) as "_1112_h瑞今代金券" , sum(S.XSJE*decode(S.SKFS,1113,1,0)) as "_1113_h美妆币-50" , sum(S.XSJE*decode(S.SKFS,1114,1,0)) as "_1114_h129元蛋糕券" , sum(S.XSJE*decode(S.SKFS,1121,1,0)) as "_1121_海VIP面包赠劵" , sum(S.XSJE*decode(S.SKFS,1122,1,0)) as "_1122_G11-200礼券" , sum(S.XSJE*decode(S.SKFS,1123,1,0)) as "_1123_G11-500礼券" , sum(S.XSJE*decode(S.SKFS,1126,1,0)) as "_1126_h好百客礼券" , sum(S.XSJE*decode(S.SKFS,1127,1,0)) as "_1127_h探乐满储次卡" , sum(S.XSJE*decode(S.SKFS,1128,1,0)) as "_1128_h团购面包赠券" , sum(S.XSJE*decode(S.SKFS,1131,1,0)) as "_1131_菲仕乐柜台代" , sum(S.XSJE*decode(S.SKFS,1132,1,0)) as "_1132_h四川美食节" , sum(S.XSJE*decode(S.SKFS,1134,1,0)) as "_1134_h-VIP代金券" , sum(S.XSJE*decode(S.SKFS,1138,1,0)) as "_1138_监审部调研" , sum(S.XSJE*decode(S.SKFS,1143,1,0)) as "_1143_顾客调研礼券" , sum(S.XSJE*decode(S.SKFS,1144,1,0)) as "_1144_h-VIP积分兑券" , sum(S.XSJE*decode(S.SKFS,1146,1,0)) as "_1146_h买手店-200" , sum(S.XSJE*decode(S.SKFS,1147,1,0)) as "_1147_h买手店-600" , sum(S.XSJE*decode(S.SKFS,1148,1,0)) as "_1148_h买手店-1000" , sum(S.XSJE*decode(S.SKFS,1149,1,0)) as "_1149_h年中大促券" , sum(S.XSJE*decode(S.SKFS,1154,1,0)) as "_1154_教师通用礼金" , sum(S.XSJE*decode(S.SKFS,1156,1,0)) as "_1156_h_VIP抽奖礼金" , sum(S.XSJE*decode(S.SKFS,1160,1,0)) as "_1160_店庆返点" , sum(S.XSJE*decode(S.SKFS,1161,1,0)) as "_1161_美妆币D" , sum(S.XSJE*decode(S.SKFS,1162,1,0)) as "_1162_美妆礼金2" , SUM((case when F.BJ_TSLQ=1 then 1 else 0 end)*S.XSJE) 券合计
from SPSKFSXS S , BM B , BM M , SKFS F
where S.DEPTID=B.DEPTID and substr(B.BMDM,1,12)=M.BMDM AND S.SKFS=F.CODE and S.RQ >= '2017-1-1' and S.RQ <= '2017-11-30' and B.BMDM LIKE '010102010201%' and ((B.BMDM like '0101%') or (B.BMDM like '0102%') or (B.BMDM like '010205%')) and B.FDBH in (1) and (S.FDBH in (1,2)) group by M.BMDM,M.DEPT_NAME order by M.BMDM


execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34591', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

14. 20171218
d5zq07ntc5qvt

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE)) 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/count(distinct C.SKTNO||to_char(C.JLBH))),2) 票单价 , SUM(C.XSSL) 销售数量 , round(DECODE(SUM(C.XSSL),0,0,SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/SUM(C.XSSL)),2) 件单价 , round(DECODE(SUM(C.XSSL),0,0,sum(S.SKJE)/SUM(C.XSSL)),2) 含券件单价 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, sum(S.SKJE)/count(distinct C.SKTNO||to_char(C.JLBH))),2) 含券票单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2017/12/16','yyyy-mm-dd') and R.RQ<=to_date('2017/12/17','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X , SKFS F
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and S.SKFS=F.CODE and L.JZRQ >=to_date('2017/12/16','yyyy-mm-dd') and L.JZRQ <=to_date('2017/12/17','yyyy-mm-dd') and B.BMDM like '0101%' and B.FDBH in (1) and (B.FDBH in (1,2,3)) and ((B.BMDM like '01%') or (B.BMDM like '0101%') or (B.BMDM like '010103%') or (B.BMDM like '0102%') or (B.BMDM like '010202010215%') or (B.BMDM like '010205%') or (B.BMDM like '01020502%') or (B.BMDM like '01020603%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34785', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

15. 20171220
fwcdcy2pgc0gd

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017/11/20','yyyy-mm-dd') and G.RQ<to_date('2017/12/20','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1,2) AND B.FDBH=M.MCID and ((B.BMDM like '010102%') or (B.BMDM like '010202%')) GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34836', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

16. 20171221
fwcdcy2pgc0g

SELECT G.SB 品牌ID , S.NAME 品牌名称 , M.BMDM 部门ID , M.DEPT_NAME 部门名称 , SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE) 销售金额含券原值 , SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE-G.XSCB_HS-nvl(G.XSCB_YG_HS,0)-nvl(G.WRZXSCB_CL_HS,0)-nvl(G.WRZXSCB_YG_HS,0)) 销售毛利含券原值 , SUM(G.XSSL) 销售数量 , SUM(G.WRZXSSL) 未入账销售数量 , 0 件单价 , 0 全部满储券满减券流水 , 0 正柜满储券满减券流水
FROM SPZHSJR G , SPSB S , BM B , BM M
WHERE G.SB=S.SBID AND G.DEPTID=B.DEPTID and substr(B.BMDM,1,8)=M.BMDM and length(M.BMDM)=8 and G.FDBH in (1) and (G.FDBH in (1,2,3)) and G.FDBH=1 and B.BMDM like '010102010201%' and G.RQ >=to_date('2017/1/1','yyyy-mm-dd') and G.RQ <= to_date('2017/12/20','yyyy-mm-dd') and ((B.BMDM like '0101020102%') or (B.BMDM like '0102020102%') or (B.BMDM like '01020202%') or (B.BMDM like '010302%')) group by G.SB,S.NAME,M.BMDM,M.DEPT_NAME having (SUM(G.XSJE+G.WRZXSJE+G.YHJE+G.WRZYHJE)<>0 OR SUM(nvl(G.XSCB_HS,0)+nvl(G.XSCB_YG_HS,0)+nvl(G.WRZXSCB_CL_HS,0)+nvl(G.WRZXSCB_YG_HS,0))<>0) ORDER BY G.SB,S.NAME,M.BMDM,M.DEPT_NAME

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_34860', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================

17. 20171229
fmzq4b4ftvk5s

SELECT B.BMDM , X.SPCODE , NVL(SUM(DECODE(F.YDCW_JK,1,nvl(XSJE,0),0)),0) XSJE_CW , NVL(SUM(DECODE(F.YDCW_JK,1,0,nvl(XSJE,0))),0) XSJE_CWQ
from SPSKFSXS G , SKFS F , SPXX X , SPXX_MC M , BM B
where G.SKFS=F.CODE AND G.SP_ID=X.SP_ID and X.SP_ID=M.SP_ID(+) and G.FDBH=M.MCID and G.DEPTID=B.DEPTID AND X.SXJHBJ<>1 and G.RQ>=to_date('2017-10-11','yyyy-mm-dd') and G.RQ<to_date('2017-12-28','yyyy-mm-dd') and B.BMDM LIKE '01010201%' and M.MCID in (1) and M.MCID in (1) AND B.FDBH=M.MCID and ((B.BMDM like '0101%') or (B.BMDM like '010202%') or (B.BMDM like '010205%') or (B.BMDM like '010299%')) and (M.HSFS in (0,1)) GROUP BY B.BMDM,X.SPCODE

execute dbms_sqltune.accept_sql_profile(task_name => 'TASK_35078', task_owner => 'SYS', replace => TRUE, force_match => true);
#======================================================================================================================================


18. 20171229
199h7bpdv34h6

select B.DEPTID , B.BMDM||B.DEPT_NAME 部门名称 , A.SBID , A.NAME 品牌 , sum(S.SKJE) 含券销售 , SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE)) 去券销售 , count(distinct C.SKTNO||to_char(C.JLBH)) 票数 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/count(distinct C.SKTNO||to_char(C.JLBH))),2) 票单价 , SUM(C.XSSL) 销售数量 , round(DECODE(SUM(C.XSSL),0,0,SUM(DECODE(F.BJ_QYHQ,1,0,S.SKJE))/SUM(C.XSSL)),2) 件单价 , round(DECODE(SUM(C.XSSL),0,0,sum(S.SKJE)/SUM(C.XSSL)),2) 含券件单价 , round(decode(count(distinct C.SKTNO||to_char(C.JLBH)),0,0, sum(S.SKJE)/count(distinct C.SKTNO||to_char(C.JLBH))),2) 含券票单价 ,
(select sum(NVL(R.XSCB_HS,0)+nvl(R.XSCB_YG_HS,0)+nvl(R.WRZXSCB_CL_HS,0)+nvl(R.WRZXSCB_YG_HS,0))
from SPZHSJR R
where A.SBID=R.SB and R.DEPTID=C.DEPTID and R.RQ>=to_date('2016/1/1','yyyy-mm-dd') and R.RQ<=to_date('2016/12/31','yyyy-mm-dd') ) as 销售成本 , 0 含券毛利 , 0 去券毛利
from SKTXSJLC C , SKTXSJLC_SKFS S , BM B , SKTXSJL L , SPSB A , SPXX X , SKFS F
where S.SKTNO=C.SKTNO and S.JLBH=C.JLBH and S.TCKT_INX=C.TCKT_INX and S.INX=C.INX and C.DEPTID=B.DEPTID and L.SKTNO=C.SKTNO and L.JLBH=C.JLBH and C.SP_ID=X.SP_ID and X.SB=A.SBID and C.SP_ID=S.SP_ID and S.SKFS=F.CODE and L.JZRQ >=to_date('2016/1/1','yyyy-mm-dd') and L.JZRQ <=to_date('2016/12/31','yyyy-mm-dd') and B.BMDM like '01010105%' and B.FDBH in (1) and (B.FDBH in (1)) and ((B.BMDM like '0101010301%') or (B.BMDM like '0101010302%') or (B.BMDM like '0101010501%') or (B.BMDM like '0101010502%') or (B.BMDM like '0101010509%') or (B.BMDM like '0101010510%')) group by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME,C.DEPTID,B.DEPTID order by B.BMDM,B.DEPT_NAME,A.SBID,A.NAME


create index BFBHDD9.IDX_FB_LYJ ON BFBHDD9.BM("FDBH", "BMDM") tablespace jxc_index; 
#======================================================================================================================================
```


## CRM库
``` perl


```